<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒì¡´ì êµì—­ì†Œ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
        authDomain: "cheongjuca.firebaseapp.com",
        databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
        projectId: "cheongjuca",
        storageBucket: "cheongjuca.firebasestorage.app",
        messagingSenderId: "455437421321",
        appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8",
        measurementId: "G-9XG7JRFM3D"
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
    </script>
    <style>
        .shop-container {
            width: 90%; max-width: 1000px; margin: 30px auto;
            color: white; font-family: 'SchoolSafeBoardMarker';
            display: flex; gap: 20px; flex-wrap: wrap;
        }
        .shop-section {
            flex: 1; background: rgba(0,0,0,0.8);
            border: 2px solid #555; border-radius: 10px;
            padding: 20px; min-width: 300px;
        }
        .header-info {
            width: 100%; text-align: center; margin-bottom: 20px;
            background: #222; padding: 15px; border-radius: 10px;
            font-size: 24px; border: 1px solid #ab0000;
        }
        .item-list {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px; max-height: 400px; overflow-y: auto;
        }
        .item-card {
            background: #333; border: 1px solid #444;
            border-radius: 5px; padding: 10px; text-align: center;
            cursor: pointer; transition: 0.2s;
        }
        .item-card:hover { border-color: gold; transform: translateY(-2px); }
        .item-icon { font-size: 40px; }
        .item-price { color: gold; font-size: 14px; margin-top: 5px; }
        
        .buy-btn {
            width: 100%; background: #ab0000; color: white; border: none;
            padding: 15px; font-size: 18px; border-radius: 5px; cursor: pointer;
            font-family: 'SchoolSafeBoardMarker'; margin-top: 10px;
        }
        .buy-btn:hover { background: #ff0000; }
    </style>
</head>
<body style="background-color: #111;">

    <nav class="navbar">
        <div class="logo">OUT BREAK</div>
        <ul class="nav-links">
            <li><a href="main.html">í™ˆ</a></li>
            <li><a href="shop.html">ìƒì </a></li>
            <li><a href="game.html">ë‚šì‹œí„°</a></li>
            <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </nav>

    <div class="shop-container">
        <div class="header-info">
            ğŸ‘¤ <span id="myNick">...</span>ë‹˜ì˜ ìì‚°<br>
            <span style="color:gold;">ğŸ’µ <span id="myMoney">0</span> G</span> | 
            <span style="color:#00ff00;">ğŸ› ë¯¸ë¼ <span id="myBait">0</span>ê°œ</span>
        </div>

        <div class="shop-section">
            <h2 style="color:#ab0000; text-align:center;">ğŸ›’ ë³´ê¸‰ì†Œ (êµ¬ë§¤)</h2>
            <div style="text-align:center; padding: 20px;">
                <div style="font-size: 80px;">ğŸ›</div>
                <h3>ìµœê³ ê¸‰ ì§€ë ì´ ë¯¸ë¼</h3>
                <p style="color:#aaa;">ë¬¼ê³ ê¸°ê°€ í™˜ì¥í•˜ëŠ” ê¿ˆí‹€ì´ì…ë‹ˆë‹¤.</p>
                <div style="color:gold; font-size:24px; margin-bottom:20px;">ê°€ê²©: 10 G</div>
                <button class="buy-btn" onclick="buyBait()">êµ¬ë§¤í•˜ê¸° (-10G)</button>
            </div>
        </div>

        <div class="shop-section">
            <h2 style="color:#4caf50; text-align:center;">ğŸ’ ë‚´ ê°€ë°© (íŒë§¤)</h2>
            <p style="text-align:center; font-size:14px; color:#aaa;">ì•„ì´í…œì„ í´ë¦­í•˜ë©´ íŒë§¤í•©ë‹ˆë‹¤.</p>
            <div class="item-list" id="inventoryGrid">
                </div>
        </div>
    </div>

    <script>
        const nick = localStorage.getItem("userNick");
        if(!nick) location.href='index.html';
        document.getElementById('myNick').innerText = nick;

        let money = 0;
        let bait = 0;
        
        // 1. ë‚´ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸° (ëˆ, ë¯¸ë¼, ì¸ë²¤í† ë¦¬)
        database.ref('users/' + nick).on('value', (snapshot) => {
            const data = snapshot.val() || {};
            
            // ì²˜ìŒ ì˜¨ ì‚¬ëŒì€ ê¸°ë³¸ ìê¸ˆ 100G, ë¯¸ë¼ 3ê°œ ì§€ê¸‰ (ì´ˆê¸°í™”)
            if (data.money === undefined) {
                database.ref('users/' + nick).update({ money: 100, bait: 3 });
                return;
            }

            money = data.money;
            bait = data.bait || 0;
            const inventory = data.inventory || {};

            // í™”ë©´ ê°±ì‹ 
            document.getElementById('myMoney').innerText = money;
            document.getElementById('myBait').innerText = bait;
            renderInventory(inventory);
        });

        // 2. ì¸ë²¤í† ë¦¬ ê·¸ë¦¬ê¸°
        function renderInventory(invData) {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = "";

            if(Object.keys(invData).length === 0) {
                grid.innerHTML = "<p style='width:100%; text-align:center;'>ê°€ë°©ì´ ë¹„ì—ˆìŠµë‹ˆë‹¤.<br>ë‚šì‹œí„°ì— ê°€ì„œ ë­ë¼ë„ ì¡ì•„ì˜¤ì„¸ìš”.</p>";
                return;
            }

            // ì¸ë²¤í† ë¦¬ ëª©ë¡ì„ ì—­ìˆœ(ìµœì‹ ìˆœ)ìœ¼ë¡œ ì •ë ¬í•˜ì—¬ í‘œì‹œ
            Object.entries(invData).reverse().forEach(([key, item]) => {
                const div = document.createElement('div');
                div.className = 'item-card';
                div.innerHTML = `
                    <div class="item-icon">${item.icon}</div>
                    <div style="font-size:12px;">${item.name}</div>
                    <div class="item-price">+ ${item.price} G</div>
                `;
                // í´ë¦­í•˜ë©´ íŒë§¤ í•¨ìˆ˜ ì‹¤í–‰
                div.onclick = () => sellItem(key, item.name, item.price);
                grid.appendChild(div);
            });
        }

        // 3. ë¯¸ë¼ êµ¬ë§¤
        function buyBait() {
            if (money < 10) {
                alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤! ë¬¼ê³ ê¸°ë¥¼ ì¡ì•„ì™€ì„œ íŒŒì„¸ìš”.");
                return;
            }
            if (confirm("ë¯¸ë¼ë¥¼ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (10G)")) {
                database.ref('users/' + nick).update({
                    money: money - 10,
                    bait: bait + 1
                });
                // alert("êµ¬ë§¤ ì™„ë£Œ!");
            }
        }

        // 4. ì•„ì´í…œ íŒë§¤
        function sellItem(key, name, price) {
            if (price <= 0) {
                // ì¢€ë¹„ ì†ëª© ê°™ì€ ê±´ íŒ” ìˆ˜ ì—†ìŒ (ë²„ë¦¬ê¸°)
                if(confirm(`${name}ì€(ëŠ”) ìƒì ì´ ë§¤ì…í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê·¸ëƒ¥ ë²„ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                    database.ref('users/' + nick + '/inventory/' + key).remove();
                }
                return;
            }

            if (confirm(`${name}ì„(ë¥¼) ${price}Gì— íŒŒì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // 1. ëˆ ì¶”ê°€
                database.ref('users/' + nick).update({
                    money: money + price
                });
                // 2. ì•„ì´í…œ ì‚­ì œ
                database.ref('users/' + nick + '/inventory/' + key).remove();
            }
        }
    </script>
</body>
</html>