<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒì¡´ì êµì—­ì†Œ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
        authDomain: "cheongjuca.firebaseapp.com",
        databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
        projectId: "cheongjuca",
        storageBucket: "cheongjuca.firebasestorage.app",
        messagingSenderId: "455437421321",
        appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8",
        measurementId: "G-9XG7JRFM3D"
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
    </script>
    <style>
        .shop-container { width: 90%; max-width: 1000px; margin: 30px auto; color: white; font-family: 'SchoolSafeBoardMarker'; display: flex; gap: 20px; flex-wrap: wrap; }
        .shop-section { flex: 1; background: rgba(0,0,0,0.8); border: 2px solid #555; border-radius: 10px; padding: 20px; min-width: 300px; }
        .header-info { width: 100%; text-align: center; margin-bottom: 20px; background: #222; padding: 15px; border-radius: 10px; font-size: 20px; border: 1px solid #ab0000; }
        .item-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px; max-height: 400px; overflow-y: auto; }
        .item-card { background: #333; border: 1px solid #444; border-radius: 5px; padding: 10px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; }
        .item-card:hover { border-color: gold; transform: translateY(-2px); }
        .item-icon { font-size: 40px; }
        .item-price { color: gold; font-size: 14px; margin-top: 5px; }
        .owned-tag { position: absolute; top: 5px; right: 5px; background: #ab0000; font-size: 10px; padding: 2px 4px; border-radius: 3px; }
    </style>
</head>
<body style="background-color: #111;">

    <nav class="navbar">
        <div class="logo">OUT BREAK <span id="userBadge"></span></div>
        <ul class="nav-links">
            <li><a href="main.html">í™ˆ</a></li>
            <li><a href="shop.html">ìƒì </a></li>
            <li><a href="game.html">ë‚šì‹œí„°</a></li>
            <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </nav>

    <div class="shop-container">
        <div class="header-info">
            ğŸ‘¤ <span id="myNick">...</span>ë‹˜ì˜ ìì‚°<br>
            <span style="color:gold;">ğŸ’µ <span id="myMoney">0</span> G</span> | 
            <span style="color:#00ff00;">ğŸ› ì¼ë°˜: <span id="myBait">0</span></span> | 
            <span style="color:#ffcc00;">ğŸª± ê³ ê¸‰: <span id="myBaitHigh">0</span></span>
        </div>

        <div class="shop-section">
            <h2 style="color:#ab0000; text-align:center;">ğŸ›’ ìƒì¡´ ë³´ê¸‰ì†Œ</h2>
            <div style="display: grid; gap: 10px;">
                <div class="item-card" onclick="buyItem('bait', 10, 'ì¼ë°˜ ë¯¸ë¼')">
                    <div class="item-icon">ğŸ›</div>
                    <div>ì¼ë°˜ ë¯¸ë¼</div>
                    <div class="item-price">10 G</div>
                </div>
                <div class="item-card" onclick="buyItem('bait_high', 35, 'ê³ ê¸‰ ë¯¸ë¼')">
                    <div class="item-icon">ğŸª±</div>
                    <div>ê³ ê¸‰ ë¯¸ë¼ (ëŒ€ì–´ í™•ë¥ UP)</div>
                    <div class="item-price">35 G</div>
                </div>
                <div class="item-card" id="rodCard" onclick="buyRod()">
                    <div id="rodTag"></div>
                    <div class="item-icon">ğŸ£</div>
                    <div>ì¹´ë³¸ ë‚šì‹¯ëŒ€ (ì„±ëŠ¥ í–¥ìƒ)</div>
                    <div class="item-price" id="rodPriceDisplay">500 G</div>
                </div>
            </div>
        </div>

        <div class="shop-section">
            <h2 style="color:#4caf50; text-align:center;">ğŸ’ ë‚´ ê°€ë°© (íŒë§¤)</h2>
            <div class="item-list" id="inventoryGrid"></div>
        </div>
    </div>

    <script>
        const nick = localStorage.getItem("userNick");
        if(!nick) location.href='index.html';
        document.getElementById('myNick').innerText = nick;

        let money = 0, bait = 0, baitHigh = 0, rodLevel = 1;

        // 1. ë°ì´í„° ì‹¤ì‹œê°„ ë¡œë“œ
        database.ref('users/' + nick).on('value', (snapshot) => {
            const data = snapshot.val() || {};
            if (data.money === undefined) {
                database.ref('users/' + nick).update({ money: 100, bait: 3, rod_level: 1 });
                return;
            }

            money = data.money;
            bait = data.bait || 0;
            baitHigh = data.bait_high || 0;
            rodLevel = data.rod_level || 1;

            document.getElementById('myMoney').innerText = money;
            document.getElementById('myBait').innerText = bait;
            document.getElementById('myBaitHigh').innerText = baitHigh;

            // ë‚šì‹¯ëŒ€ ì†Œì§€ ì—¬ë¶€ í‘œì‹œ
            if(rodLevel >= 2) {
                document.getElementById('rodTag').innerHTML = '<span class="owned-tag">ë³´ìœ ì¤‘</span>';
                document.getElementById('rodPriceDisplay').innerText = "SOLD OUT";
            }

            renderInventory(data.inventory || {});
        });

        // 2. ë¯¸ë¼ êµ¬ë§¤
        function buyItem(type, price, name) {
            if (money < price) return alert("ìê¸ˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤!");
            if (confirm(`${name}ì„(ë¥¼) êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                let updates = { money: money - price };
                if(type === 'bait') updates.bait = bait + 1;
                if(type === 'bait_high') updates.bait_high = baitHigh + 1;
                database.ref('users/' + nick).update(updates);
            }
        }

        // 3. ë‚šì‹¯ëŒ€ êµ¬ë§¤
        function buyRod() {
            if (rodLevel >= 2) return alert("ì´ë¯¸ ìµœê³ ê¸‰ ë‚šì‹¯ëŒ€ë¥¼ ë³´ìœ í•˜ê³  ìˆìŠµë‹ˆë‹¤.");
            if (money < 500) return alert("ëˆì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ë‚šì‹œë¡œ ëˆì„ ë” ëª¨ìœ¼ì„¸ìš”!");
            if (confirm("ì¹´ë³¸ ë‚šì‹¯ëŒ€ë¥¼ êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ê²Œì´ì§€ ì¡°ì ˆì´ ì‰¬ì›Œì§€ê³  ì§„í–‰ë„ê°€ ë¹¨ë¦¬ ì˜¤ë¦…ë‹ˆë‹¤)")) {
                database.ref('users/' + nick).update({
                    money: money - 500,
                    rod_level: 2
                });
                alert("ì¥ë¹„ ì—…ê·¸ë ˆì´ë“œ ì™„ë£Œ!");
            }
        }

        function renderInventory(invData) {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = "";
            Object.entries(invData).reverse().forEach(([key, item]) => {
                const div = document.createElement('div');
                div.className = 'item-card';
                div.innerHTML = `<div class="item-icon">${item.icon}</div><div style="font-size:12px;">${item.name}</div><div class="item-price">+ ${item.price} G</div>`;
                div.onclick = () => sellItem(key, item.name, item.price);
                grid.appendChild(div);
            });
        }

        function sellItem(key, name, price) {
            if (price <= 0) {
                if(confirm(`${name}ì€(ëŠ”) ê°€ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤. ë²„ë¦¬ì‹œê² ìŠµë‹ˆê¹Œ?`)) database.ref('users/' + nick + '/inventory/' + key).remove();
                return;
            }
            if (confirm(`${name}ì„(ë¥¼) ${price}Gì— íŒë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                database.ref('users/' + nick).update({ money: money + price });
                database.ref('users/' + nick + '/inventory/' + key).remove();
            }
        }
        function logout() { localStorage.removeItem("loginStatus"); location.href = "index.html"; }
    </script>
</body>
</html>