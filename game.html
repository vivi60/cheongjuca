<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Í≥†Ïû•ÎÇú ÏûêÌåêÍ∏∞ (Fixed Hit)</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap');
        
        body {
            background-color: #1a1a1a;
            color: #d0d0d0;
            font-family: 'Courier Prime', monospace;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 20px; min-height: 100vh; box-sizing: border-box;
            cursor: url(http://www.rw-designer.com/cursor-extern.php?id=88921), auto !important;
            user-select: none;
        }

        .game-container {
            background: #222; border: 4px solid #444; border-radius: 10px;
            width: 90%; max-width: 800px; padding: 20px;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            display: flex; flex-direction: column; gap: 15px; position: relative;
        }

        .top-bar {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px dashed #555; padding-bottom: 10px; font-size: 14px; flex-wrap: wrap; gap:10px;
        }
        .user-info span { color: #f0d090; font-weight: bold; margin-right: 10px; }
        .retro-btn {
            padding: 5px 10px; border: 1px solid #666; background: #333; color: #aaa; cursor: pointer;
            font-family: 'Courier Prime'; transition: 0.2s;
        }
        .retro-btn:hover { color: #fff; border-color: #fff; }

        /* --- ÏïÑÏù¥ÌÖú ÏßÑÏó¥Ïû• UI --- */
        #shelfZone {
            background: #111; border: 5px solid #333; border-radius: 5px;
            padding: 15px; position: relative;
            box-shadow: inset 0 0 50px #000;
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;
        }
        
        #shelfZone::after {
            content: ''; position: absolute; top:0; left:0; width:100%; height:100%;
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 40%, rgba(255,255,255,0.05) 100%);
            pointer-events: none; z-index: 10;
        }

        .shelf-slot {
            background: #222; border: 2px solid #444; border-radius: 5px;
            padding: 10px; display: flex; flex-direction: column; align-items: center;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .shelf-slot:hover { border-color: #888; background: #2a2a2a; }
        .shelf-slot.selected { 
            border-color: #00ff00; background: #001100; 
            box-shadow: 0 0 15px #00ff00; transform: scale(1.05); z-index: 5;
        }

        .slot-emoji { font-size: 40px; margin-bottom: 5px; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .slot-name { font-size: 11px; color: #aaa; text-align: center; margin-bottom: 5px; height: 26px;}
        .slot-diff { 
            font-family: 'Black Ops One'; font-size: 12px; color: #ff5555; 
            background: #000; padding: 2px 5px; border-radius: 3px; border: 1px solid #555;
        }
        .btn-select {
            margin-top: 5px; width: 100%; background: #333; border: 1px solid #555; 
            color: #ddd; font-size: 10px; cursor: pointer;
        }
        .shelf-slot.selected .btn-select { background: #00ff00; color: #000; font-weight: bold; border-color: #00ff00; }

        /* --- ÌÉÄÏù¥Î∞ç Í≤åÏûÑ Ïò§Î≤ÑÎ†àÏù¥ --- */
        #gameOverlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            border-radius: 10px;
        }

        #hackZone {
            width: 350px; padding: 20px;
            background: #0d0d0d; border: 2px solid #444; border-radius: 10px;
            box-shadow: 0 0 20px #000; text-align: center;
        }

        .hack-header {
            font-family: 'Black Ops One'; color: #fff; font-size: 20px; margin-bottom: 10px;
            text-shadow: 0 0 10px #0f0;
        }

        /* Î™©Ïà® UI */
        .lives-container { font-size: 24px; margin-bottom: 15px; letter-spacing: 5px; }
        .heart { color: #ff0000; text-shadow: 0 0 10px #ff0000; transition: 0.3s; }
        .heart.lost { color: #333; text-shadow: none; filter: grayscale(1); }

        /* ÌÉÄÏù¥Î∞ç Î∞î Ïª®ÌÖåÏù¥ÎÑà */
        .timing-container {
            position: relative; width: 100%; height: 40px;
            background: #222; border: 2px solid #555; border-radius: 20px;
            margin-bottom: 30px; overflow: hidden;
            box-shadow: inset 0 0 10px #000;
        }
        
        .timing-container::before {
            content: " "; display: block; position: absolute; top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 20; background-size: 100% 2px, 3px 100%; pointer-events: none;
        }

        /* [ÏàòÏ†ï] ÏÑ±Í≥µ Íµ¨Ïó≠ - transform ÏÜçÏÑ± Ï†úÍ±∞ (Ï¢åÌëú Ï∂©Îèå ÏõêÏù∏) */
        .target-zone {
            position: absolute; top: 0; bottom: 0; left: 0; 
            width: 60px;
            background: rgba(0, 255, 0, 0.4);
            border-left: 2px solid #0f0; border-right: 2px solid #0f0;
            z-index: 1;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
        }

        .cursor-bar {
            position: absolute; top: 0; bottom: 0; left: 0; width: 4px;
            background: #fff; box-shadow: 0 0 10px #fff;
            z-index: 2;
        }
        
        .glitch-flicker { animation: flicker 3s infinite; }
        @keyframes flicker {
            0% { opacity: 1; } 90% { opacity: 1; } 92% { opacity: 0.1; } 
            93% { opacity: 1; } 96% { opacity: 1; } 98% { opacity: 0.1; } 100% { opacity: 1; }
        }

        .progress-dots { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .dot { 
            width: 15px; height: 15px; background: #333; border-radius: 50%; border: 1px solid #555; 
            transition: 0.2s;
        }
        .dot.active { background: #0f0; box-shadow: 0 0 10px #0f0; border-color: #fff; }

        #stopBtnGame {
            width: 100%; padding: 20px; font-size: 24px; font-family: 'Black Ops One';
            background: #ab0000; color: #fff; border: none; border-radius: 5px;
            cursor: pointer; box-shadow: 0 5px 0 #600;
        }
        #stopBtnGame:active { transform: translateY(5px); box-shadow: none; }

        #resultMsg {
            position: absolute; top: 20%; width: 100%; text-align: center;
            font-family: 'Black Ops One'; font-size: 40px; 
            text-shadow: 0 0 20px #000; pointer-events: none; opacity: 0;
            transition: 0.2s; z-index: 200;
        }

        .control-panel {
            display: flex; justify-content: center; gap: 20px; padding: 15px;
            background: #222; border-top: 2px solid #333; align-items: center;
        }
        #confirmDisplay { color: #888; font-size: 14px; margin-right: 10px; }
        #startBtn {
            padding: 15px 40px; font-size: 18px; font-family: 'Black Ops One';
            background: #ab0000; color: #fff; border: none; border-radius: 5px;
            cursor: pointer; box-shadow: 0 5px 0 #500; transition: 0.1s;
        }
        #startBtn:active { transform: translateY(5px); box-shadow: none; }
        #startBtn:disabled { background: #444; color: #888; box-shadow: none; cursor: not-allowed; }

        .bottom-section { display: flex; gap: 10px; height: 150px; }
        .log-box, .inv-box {
            flex: 1; background: #1a1a1a; border: 1px solid #444; padding: 10px;
            overflow-y: auto; font-size: 12px;
        }
        .log-item { margin: 2px 0; color: #888; }
        .log-success { color: #88ff88; }
        .log-fail { color: #ff8888; }
        
        #invGrid { display: grid; grid-template-columns: repeat(auto-fill, minmax(40px, 1fr)); gap: 5px; }
        .inv-item { background: #333; border: 1px solid #555; text-align: center; padding: 5px; position: relative; font-size: 18px; }
        .inv-item span { position: absolute; bottom: 0; right: 0; font-size: 10px; background: rgba(0,0,0,0.8); color: #fff; padding: 0 2px; }

        .damage-shake { animation: shake 0.5s; }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

    </style>
</head>
<body>

    <div class="game-container">
        <div class="top-bar">
            <div class="user-info">
                ID: <span id="userIdDisplay">Guest</span> | 
                üíµ: <span id="userMoneyDisplay">loading...</span>
            </div>
            <div>
                <button class="retro-btn" onclick="location.href='shop.html'">üéí ÍµêÌôòÏÜå</button>
                <button class="retro-btn" onclick="location.href='main.html'">üè† Î©îÏù∏</button>
            </div>
        </div>

        <div id="shelfZone"></div>

        <div class="control-panel">
            <div id="confirmDisplay">Î¨ºÍ±¥ÏùÑ Î®ºÏ†Ä ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div>
            <button id="startBtn" onclick="startGame()" disabled>START (-10G)</button>
        </div>

        <div class="bottom-section">
            <div class="log-box" id="actionLog">
                <div class="log-item">> Í≥†Ïû•ÎÇú ÏûêÌåêÍ∏∞ÏûÖÎãàÎã§.</div>
                <div class="log-item">> Î¨ºÍ±¥ÏùÑ Í≥†Î•¥Í≥† [START]Î•º ÎàÑÎ•¥ÏÑ∏Ïöî.</div>
                <div class="log-item">> Î™©Ìëú: ÌùîÎì§Î¶¨Îäî Ï¥àÎ°ù Íµ¨Ïó≠Ïóê ÎßâÎåÄÎ•º Î©àÏ∂îÏÑ∏Ïöî!</div>
            </div>
            <div class="inv-box">
                <div style="border-bottom: 1px dashed #555; margin-bottom: 5px;">ÎÇ¥ Í∞ÄÎ∞© (Î°úÏª¨)</div>
                <div id="invGrid"></div>
            </div>
        </div>

        <div id="gameOverlay">
            <div id="hackZone">
                <div class="hack-header">BYPASS SECURITY...</div>
                
                <div class="lives-container" id="livesDisplay">
                    <span class="heart">‚ù§</span>
                </div>

                <div class="progress-dots">
                    <div class="dot" id="dot1"></div>
                    <div class="dot" id="dot2"></div>
                    <div class="dot" id="dot3"></div>
                </div>
                
                <div class="timing-container" id="timingContainer">
                    <div class="target-zone" id="targetZone"></div>
                    <div class="cursor-bar" id="cursor"></div>
                </div>

                <div class="hack-info">Space Bar ÎòêÎäî Î≤ÑÌäºÏùÑ ÎàÑÎ•¥ÏÑ∏Ïöî</div>
                <button id="stopBtnGame" onmousedown="hitCheck()">STOP!</button>
            </div>
            <div id="resultMsg">SUCCESS!</div>
        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
            authDomain: "cheongjuca.firebaseapp.com",
            databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
            projectId: "cheongjuca",
            storageBucket: "cheongjuca.firebasestorage.app",
            messagingSenderId: "455437421321",
            appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const vendingItems = [
            { id: 0, name: "ÎØ∏ÏßÄÍ∑ºÌïú Ï∫îÏª§Ìîº", emoji: "‚òï", price: 50, zoneSize: 80, baseSpeed: 5, driftSpeed: 0, desc: "Ïâ¨ÏõÄ", lives: 1 },
            { id: 1, name: "Ï∞åÍ∑∏Îü¨ÏßÑ Ï∫îÏùåÎ£å", emoji: "ü•§", price: 80, zoneSize: 70, baseSpeed: 7, driftSpeed: 1, desc: "Î≥¥ÌÜµ", lives: 1 },
            { id: 2, name: "Ïú†ÌÜµÍ∏∞Ìïú ÏßÄÎÇú Í≥ºÏûê", emoji: "üç™", price: 120, zoneSize: 60, baseSpeed: 9, driftSpeed: 2, desc: "Ïñ¥Î†§ÏõÄ", lives: 1 },
            { id: 3, name: "ÎÖπÏïÑÎÇ¥Î¶∞ Ï¥àÏΩúÎ¶ø", emoji: "üç´", price: 200, zoneSize: 50, baseSpeed: 11, driftSpeed: 3, desc: "Îß§Ïö∞ Ïñ¥Î†§ÏõÄ", lives: 1 },
            { id: 4, name: "ÏàòÏÉÅÌïú ÏóêÎÑàÏßÄÎìúÎßÅÌÅ¨", emoji: "‚ö°", price: 500, zoneSize: 40, baseSpeed: 14, driftSpeed: 5, desc: "Ï†ÑÏïï Î∂àÏïàÏ†ï", lives: 2 },
            { id: 5, name: "Î∞òÏßùÏù¥Îäî ÎèôÏ†Ñ ÏßÄÍ∞ë", emoji: "üëõ", price: 2000, zoneSize: 25, baseSpeed: 18, driftSpeed: 7, desc: "Í∑πÏïÖ", lives: 2 } 
        ];

        let selectedItemIdx = -1;
        let currentUser = null;
        let currentMoney = 0;
        let rodLevel = 1;

        let isPlaying = false;
        let currentStage = 0; 
        let currentLives = 1;
        
        let cursorX = 0;
        let cursorDir = 1;
        
        let targetX = 0;
        let targetDir = 1;
        let targetMaxMove = 0; 

        let animFrame;
        const PLAY_COST = 10;
        const CONTAINER_WIDTH = 306; 

        window.onload = function() {
            currentUser = localStorage.getItem("loginID");
            if (!currentUser) { alert("Î°úÍ∑∏Ïù∏ ÌïÑÏöî"); location.href="index.html"; return; }
            document.getElementById("userIdDisplay").innerText = currentUser;

            database.ref(`users/${currentUser}`).on('value', snap => {
                const data = snap.val() || {};
                currentMoney = data.money || 0;
                rodLevel = data.rod_level || 1;
                document.getElementById("userMoneyDisplay").innerText = currentMoney;
            });

            renderShelves();
            renderLocalInventory();

            window.addEventListener('keydown', e => {
                if(isPlaying && e.code === 'Space') hitCheck();
            });
        };

        function renderShelves() {
            const shelf = document.getElementById('shelfZone');
            shelf.innerHTML = "";
            vendingItems.forEach((item, idx) => {
                const div = document.createElement('div');
                div.className = `shelf-slot ${idx === selectedItemIdx ? 'selected' : ''}`;
                const lifeText = item.lives > 1 ? `<span style="color:red">‚ù§x${item.lives}</span>` : "";
                div.innerHTML = `
                    <div class="slot-emoji">${item.emoji}</div>
                    <div class="slot-name">${item.name}</div>
                    <div class="slot-diff">${item.desc} ${lifeText}</div>
                    <button class="btn-select">ÏÑ†ÌÉù</button>
                `;
                div.onclick = () => selectItem(idx);
                shelf.appendChild(div);
            });
        }

        function selectItem(idx) {
            if(isPlaying) return;
            selectedItemIdx = idx;
            renderShelves();
            const item = vendingItems[idx];
            document.getElementById('confirmDisplay').innerHTML = 
                `<span style="color:#fff">${item.name}</span> ÏÑ†ÌÉùÎê®`;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('startBtn').innerText = `ÎèÑÏ†ÑÌïòÍ∏∞ (-${PLAY_COST}G)`;
        }

        function startGame() {
            if (selectedItemIdx === -1) return;
            if (currentMoney < PLAY_COST) {
                log("ÎèàÏù¥ Î∂ÄÏ°±Ìï©ÎãàÎã§!", "fail");
                return;
            }

            database.ref(`users/${currentUser}/money`).set(currentMoney - PLAY_COST);

            isPlaying = true;
            currentStage = 0;
            currentLives = vendingItems[selectedItemIdx].lives;
            updateLivesUI();
            resetDots();
            
            document.getElementById('gameOverlay').style.display = "flex";
            document.getElementById('resultMsg').style.opacity = 0;
            
            const item = vendingItems[selectedItemIdx];
            if(item.driftSpeed > 0) log("Í≤ΩÍ≥†: ÌÉÄÍ≤üÏù¥ ÏõÄÏßÅÏûÖÎãàÎã§!", "fail");
            if(item.baseSpeed > 12) log("Í≤ΩÍ≥†: Ï†ÑÏïï Î∂àÏïàÏ†ï (ÏÜçÎèÑ Î≥ÄÌôî)", "fail");

            startStage();
        }

        function updateLivesUI() {
            const container = document.getElementById('livesDisplay');
            container.innerHTML = "";
            const maxLives = vendingItems[selectedItemIdx].lives;
            for(let i=0; i<maxLives; i++) {
                const span = document.createElement('span');
                span.className = "heart";
                span.innerText = "‚ù§";
                if (i >= currentLives) {
                    span.classList.add("lost");
                }
                container.appendChild(span);
            }
        }

        function startStage() {
            const item = vendingItems[selectedItemIdx];
            
            let safeZone = item.zoneSize;
            let currentCursorSpeed = item.baseSpeed + (currentStage * 2);
            let currentDriftSpeed = item.driftSpeed;

            if (rodLevel >= 2) {
                safeZone *= 1.3; 
                currentCursorSpeed *= 0.85; 
            }

            const targetEl = document.getElementById('targetZone');
            const cursorEl = document.getElementById('cursor');

            targetEl.style.width = safeZone + "px";
            cursorEl.style.left = "0px";
            
            targetMaxMove = CONTAINER_WIDTH - safeZone;
            targetX = Math.random() * targetMaxMove; 
            targetEl.style.left = targetX + "px";

            targetDir = Math.random() < 0.5 ? 1 : -1;
            cursorX = 0;
            cursorDir = 1;

            if (currentStage === 2) cursorEl.classList.add('glitch-flicker');
            else cursorEl.classList.remove('glitch-flicker');

            function loop() {
                if(!isPlaying) return;

                let jitter = (Math.random() * 4) - 2; 
                if (item.baseSpeed < 10) jitter = 0; 
                
                cursorX += (currentCursorSpeed + jitter) * cursorDir;
                
                if(cursorX >= CONTAINER_WIDTH - 4 || cursorX <= 0) {
                    cursorDir *= -1;
                    cursorX = Math.max(0, Math.min(cursorX, CONTAINER_WIDTH - 4));
                }
                
                if (currentDriftSpeed > 0) {
                    targetX += currentDriftSpeed * targetDir;
                    if(targetX >= targetMaxMove || targetX <= 0) {
                        targetDir *= -1;
                    }
                    targetEl.style.left = targetX + "px";
                }
                
                cursorEl.style.left = cursorX + "px";
                animFrame = requestAnimationFrame(loop);
            }
            loop();
        }

        // [ÌïµÏã¨ ÏàòÏ†ï] ÌåêÏ†ï Î°úÏßÅ: Î≥¥Ïù¥Îäî Í∑∏ÎåÄÎ°ú ÌåêÏ†ï (getBoundingClientRect)
        function hitCheck() {
            if(!isPlaying) return;
            cancelAnimationFrame(animFrame);

            const cursorEl = document.getElementById('cursor');
            const targetEl = document.getElementById('targetZone');

            // ÌôîÎ©¥ÏÉÅ Ïã§Ï†ú Ï¢åÌëú Í∞ÄÏ†∏Ïò§Í∏∞ (Ï†àÎåÄ Ï¢åÌëú)
            const cRect = cursorEl.getBoundingClientRect();
            const tRect = targetEl.getBoundingClientRect();

            // Ïª§ÏÑúÏùò Ï§ëÏã¨Ï†ê
            const cCenter = cRect.left + (cRect.width / 2);

            // ÌåêÏ†ï: Ïª§ÏÑú Ï§ëÏã¨Ïù¥ ÌÉÄÍ≤ü Î∞ïÏä§ ÏïàÏóê ÏûàÎäîÍ∞Ä?
            if (cCenter >= tRect.left && cCenter <= tRect.right) {
                // SUCCESS
                document.getElementById(`dot${currentStage+1}`).classList.add('active');
                currentStage++;

                if(currentStage >= 3) {
                    showResult("SUCCESS!", "#0f0");
                    setTimeout(() => giveReward(selectedItemIdx), 1000);
                } else {
                    setTimeout(startStage, 500);
                }
            } else {
                // FAIL
                currentLives--;
                updateLivesUI();
                
                const overlay = document.getElementById('hackZone');
                overlay.classList.add('damage-shake');
                setTimeout(()=>overlay.classList.remove('damage-shake'), 500);

                if (currentLives > 0) {
                    showResult("WARNING!", "#ff9900");
                    log("Ï∂©Í≤© Í∞êÏßÄ! ÏãúÏä§ÌÖúÏù¥ Î∂àÏïàÏ†ïÌï©ÎãàÎã§. (Ïû¨ÏãúÎèÑ)", "fail");
                    setTimeout(() => {
                        document.getElementById('resultMsg').style.opacity = 0;
                        startStage(); 
                    }, 1000);
                } else {
                    showResult("FAILED...", "#f00");
                    setTimeout(endGame, 1000);
                }
            }
        }

        function showResult(text, color) {
            const msg = document.getElementById('resultMsg');
            msg.innerText = text; msg.style.color = color; msg.style.opacity = 1;
            msg.style.transform = "scale(1.5)";
            setTimeout(() => msg.style.transform = "scale(1)", 200);
        }

        function endGame() {
            isPlaying = false;
            document.getElementById('gameOverlay').style.display = "none";
        }

        function resetDots() {
            for(let i=1; i<=3; i++) document.getElementById(`dot${i}`).classList.remove('active');
        }

        function giveReward(idx) {
            let item = vendingItems[idx];
            let isGlitch = false;

            if (Math.random() < 0.3) {
                isGlitch = true;
                const randIdx = Math.floor(Math.random() * vendingItems.length);
                item = vendingItems[randIdx];
            }

            const inv = getLocalInv();
            inv[item.name] = (inv[item.name] || 0) + 1;
            inv[item.name + "_price"] = item.price;
            inv[item.name + "_icon"] = item.emoji;
            localStorage.setItem("myInventory", JSON.stringify(inv));
            renderLocalInventory();

            if (isGlitch) {
                log(`‚ö†Ô∏è ÌöåÎ°ú Ïò§ÏûëÎèô! ÏóâÎö±Ìïú Î¨ºÍ±¥ ÌöçÎìù: [${item.emoji} ${item.name}]`, "fail");
            } else {
                log(`Ïû†Í∏à Ìï¥Ï†ú ÏÑ±Í≥µ! [${item.emoji} ${item.name}] ÌöçÎìù`, "success");
            }
            endGame();
        }

        function log(msg, type="") {
            const box = document.getElementById("actionLog");
            const div = document.createElement("div");
            div.className = "log-item " + (type==="success"?"log-success":type==="fail"?"log-fail":"");
            div.innerText = "> " + msg;
            box.prepend(div);
        }

        function getLocalInv() { return JSON.parse(localStorage.getItem("myInventory") || "{}"); }
        function renderLocalInventory() {
            const grid = document.getElementById("invGrid");
            grid.innerHTML = "";
            const inv = getLocalInv();
            for (const [key, val] of Object.entries(inv)) {
                if (!key.includes("_price") && !key.includes("_icon") && val > 0) {
                    const icon = inv[key+"_icon"] || "üì¶";
                    grid.innerHTML += `<div class="inv-item">${icon}<span>${val}</span></div>`;
                }
            }
        }
    </script>
</body>
</html>