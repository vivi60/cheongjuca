<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>PROJECT: OUTBREAK</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap');

       body {
    background-color: #1a1a1a;
    background-image: 
        linear-gradient(rgba(20,20,30,0.8), rgba(0,0,0,0.9)), /* 푸른빛이 도는 어둠 */
        url('https://www.transparenttextures.com/patterns/concrete-wall.png');
        margin: 0;
            display: flex;
            /* 문서를 오른쪽으로 배치 */
            justify-content: flex-end; 
            align-items: center;
            height: 100vh;
            overflow: hidden;
            font-family: 'Courier Prime', monospace;
            cursor: url(http://www.rw-designer.com/cursor-extern.php?id=88921), auto !important;
            /* 오른쪽 여백 확보 */
            padding-right: 8%;
            box-sizing: border-box;
        }

        /* --- 배경 장식 레이어 (왼쪽 공간: 핏자국, 필름, 슬레이트) --- */
        .desk-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        /* 1. 필름 (배경에 크게 깔기) */
        .film-strip-bg {
            position: absolute;
            top: -10%; left: -10%;
            width: 70%; /* 크기를 키워서 웅장하게 */
            opacity: 0.3;
            transform: rotate(25deg);
            filter: blur(2px) grayscale(100%);
            z-index: 1;
        }

        /* 2. 핏자국 (왼쪽 상단 포인트) */
        .blood-stain {
            position: absolute;
            top: 5%; left: 5%;
            width: 35%;
            opacity: 0.7;
            transform: rotate(15deg);
            mix-blend-mode: multiply; /* 배경과 자연스럽게 합성 */
            filter: drop-shadow(5px 5px 10px rgba(50, 0, 0, 0.5));
            z-index: 2;
        }

        /* 3. 슬레이트 (왼쪽 하단 메인 장식) */
        .slate-bg {
            position: absolute;
            bottom: 10%; left: 10%;
            width: 35%;
            opacity: 0.9;
            transform: rotate(-10deg);
            filter: drop-shadow(15px 15px 30px rgba(0,0,0,0.8));
            z-index: 3;
        }

        /* --- 메인 콘텐츠 래퍼 --- */
        .content-wrapper {
            position: relative;
            width: 500px;
            height: 85vh;
            display: flex;
            justify-content: center;
            z-index: 10;
        }

        /* --- 책갈피 버튼 그룹 (검정색 스타일 복구) --- */
        .bookmark-buttons {
            position: absolute;
            /* 문서 안쪽으로 파고들게 위치 조정 (끼워진 느낌) */
            right: 30px; 
            top: 110px; 
            display: flex;
            flex-direction: column;
            gap: 12px;
            
            /* 문서(z-index 20)보다 낮고, 뒷문서(z-index 10)보다 높게 */
            z-index: 22; 
            transform: rotate(1deg); 
        }

        .btn {
            background: #1a1a1a; /* 검정색 배경 복구 */
            color: #f0f0f0;
            border: none;
            padding: 15px 0;
            font-family: 'Courier Prime', monospace;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            
            width: 35px; height: 110px;
            
            /* 책갈피 모양: 오른쪽만 둥글게 */
            border-radius: 0 10px 10px 0; 
            box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            
            /* 오른쪽 테두리 포인트 */
            border-right: 3px solid #ab0000; 
            
            writing-mode: vertical-rl; 
            text-orientation: mixed;
            transform: rotate(180deg); 
            display: flex; align-items: center; justify-content: center;
        }

        /* 호버 시 튀어나오는 효과 */
        .btn:hover {
            background: #ab0000;
            color: #fff;
            transform: rotate(180deg) translateX(-20px); 
            box-shadow: 5px 5px 15px rgba(0,0,0,0.6);
        }

        /* --- 기밀 서류 파일 --- */
        .secret-file {
            position: absolute;
            width: 450px;
            height: 100%;
            background: #fdfbf7;
            padding: 25px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4), inset 0 0 60px rgba(139, 69, 19, 0.05);
            border: 1px solid #e0d8c8;
            box-sizing: border-box;
        }

        /* 겹쳐진 뒷 문서들 */
        .layered-doc-1 { top: 12px; left: -12px; transform: rotate(-2deg); z-index: 11; background: #fcfae1; }
        .layered-doc-2 { top: 6px; left: -6px; transform: rotate(-1deg); z-index: 12; background: #f9f7e8; }
        
        /* 메인 문서 (가장 위) */
        .main-doc {
            top: 0; left: 0;
            transform: rotate(1deg);
            z-index: 20; /* 버튼(15)보다 위로 올려서 버튼 뿌리를 가림 */
            box-shadow: 0 15px 35px rgba(0,0,0,0.5), inset 0 0 50px rgba(139, 69, 19, 0.1);
        }

        .paper-clip {
            position: absolute;
            top: -15px; left: 40px;
            width: 70px; height: 35px;
            background: #555;
            border-radius: 18px;
            box-shadow: 2px 3px 5px rgba(0,0,0,0.4);
            z-index: 25;
            transform: rotate(-5deg);
        }

        .stamp-mark {
            position: absolute;
            bottom: 40px; right: 30px;
            border: 3px solid #ab0000;
            color: #ab0000;
            padding: 5px 12px;
            font-weight: bold;
            font-size: 16px;
            transform: rotate(-20deg);
            opacity: 0.7;
            letter-spacing: 2px;
            mask-image: url('https://www.transparenttextures.com/patterns/grunge-wall.png');
            -webkit-mask-image: url('https://www.transparenttextures.com/patterns/grunge-wall.png');
        }

        .file-header {
            text-align: center;
            border-bottom: 2px solid #000;
            padding-bottom: 15px;
            margin-bottom: 20px;
            margin-top: 15px;
        }
        
        .file-title {
            font-family: 'Black Ops One', cursive;
            font-size: 32px;
            margin: 8px 0;
            color: #111;
            text-transform: uppercase;
        }

        .photo-area {
            flex: 1;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 2px 2px 8px rgba(0,0,0,0.15);
            transform: rotate(-0.5deg);
            display: flex; justify-content: center; align-items: center;
            position: relative;
            margin-bottom: 20px;
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            min-height: 250px;
            overflow: hidden;
        }

        .actor-img {
            max-width: 95%; max-height: 95%;
            object-fit: contain;
        }

        .tape {
            position: absolute;
            top: -12px; left: 50%; transform: translateX(-50%) rotate(-2deg);
            width: 90px; height: 25px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(1px);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .footer-info {
            margin-top: auto;
            font-size: 11px;
            color: #333;
            border-top: 1px dashed #555;
            padding-top: 12px;
            line-height: 1.5;
            background: rgba(0,0,0,0.02);
            padding: 10px;
        }
    </style>
</head>
<body>
    <nav class="navbar">
    <div class="logo">
        OUT BREAK 
        <span id="userBadge" style="display: none; font-size: 14px; margin-left: 10px; vertical-align: middle;"></span>
    </div>
    <ul class="nav-links">
        <li><a href="main.html">홈</a></li>
        <li><a href="sub.html">생존자목록</a></li>
        <li><a href="board.html">자유게시판</a></li>
        <li><a href="quest.html">의뢰게시판</a></li>
        <li><a href="game.html">낚시터</a></li>
        <li><a href="vending.html">자판기</a></li>
        <li><a href="#" onclick="logout()">로그아웃</a></li>
    </ul>
    </nav>
    <div class="desk-layer">
        <img src="https://i.ibb.co/5x12kJGs/pngegg-2.png" class="blood-stain" alt="blood stain">
        <img src="https://i.ibb.co/ZRCc408R/pngegg-1.png" class="film-strip-bg" alt="film">
        <img src="https://i.ibb.co/rRfHLnmg/pngegg.png" class="slate-bg" alt="slate">
    </div>

    <div class="content-wrapper">
        
        <div class="bookmark-buttons">
            <button class="btn btn-1" onclick="location.href='sub.html'">SUBJECT LIST</button>
            <button class="btn btn-2" onclick="location.href='quest.html'">MISSION LOG</button>
            <button class="btn btn-3" onclick="logout()">TERMINATE</button>
        </div>

        <div class="secret-file layered-doc-1"></div>
        <div class="secret-file layered-doc-2"></div>

        <div class="secret-file main-doc">
            <div class="paper-clip"></div>
            
            <div class="file-header">
                <div style="font-size: 10px; color: #666;">CASE FILE #2026-01-21</div>
                <h1 class="file-title">PROJECT: OUTBREAK</h1>
                <div style="font-size: 11px; color: #ab0000; font-weight: bold;">Warning: Biohazard Protocol Active.</div>
            </div>

            <div class="photo-area">
                <div class="tape"></div>
                <img id="survivorImage" src="https://i.ibb.co/HTdk743s/image.png" class="actor-img">
            </div>

            <div class="footer-info">
                <strong>OPERATOR:</strong> <span id="userNickDisplay">loading...</span><br>
                <strong>RESOURCE:</strong> <span id="userMoneyDisplay">0</span> Credits<br>
                <strong>STATUS:</strong> MONITORING...
            </div>
            
            <div class="stamp-mark">TOP SECRET</div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
            authDomain: "cheongjuca.firebaseapp.com",
            databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
            projectId: "cheongjuca",
            storageBucket: "cheongjuca.firebasestorage.app",
            messagingSenderId: "455437421321",
            appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();


        window.onload = function() {
            // 로그인 상태 체크
            const status = localStorage.getItem("loginStatus");
            if (!status || (status !== "success" && status !== "admin")) {
                alert("로그인이 필요합니다.");
                location.href = "index.html";
                return;
            }

            // 뱃지 표시 로직 수정 (수정된 부분)
            const nick = localStorage.getItem("userNick");
            const badge = document.getElementById("userBadge");
            if (badge && nick) {
                if (status === "admin") {
                    badge.innerText = `[관리자 모드]`;
                    badge.style.color = "#ff0000"; // 빨간 글씨
                } else {
                    badge.innerText = `[${nick}]`;
                    badge.style.color = "#cccccc";
                }
                badge.style.display = "inline";
            }

            loadRandomSurvivor();
            updateInfo();
        };
        
        async function loadRandomSurvivor() {
            const imgEl = document.getElementById('survivorImage');
            try {
                const snap = await database.ref('users').once('value');
                const users = snap.val();
                if (!users) return;
                const imgList = Object.values(users).filter(u => u.fullBodyImg).map(u => u.fullBodyImg);
                if (imgList.length > 0) {
                    imgEl.src = imgList[Math.floor(Math.random() * imgList.length)];
                }
            } catch (e) { console.error(e); }
        }

        function updateInfo() {
            const myID = localStorage.getItem("loginID");
            const myNick = localStorage.getItem("userNick") || "Unknown";
            document.getElementById('userNickDisplay').innerText = myNick;
            if (myID) {
                database.ref(`users/${myID}/money`).on('value', (snap) => {
                    document.getElementById('userMoneyDisplay').innerText = snap.val() || 0;
                });
            }
        }

        function logout() { localStorage.clear(); location.href='index.html'; }
    </script>
</body>
</html>