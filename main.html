<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>홈페이지 메인</title>
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Courier+Prime:wght@400;700&family=Black+Han+Sans&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        body {
            margin: 0; padding: 0;
            background-color: #000;
            color: white;
            font-family: 'Courier Prime', 'Noto Sans KR', monospace;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            position: relative;
        }

        /* [공통 레이어] */
        .layer {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; 
            display: flex; justify-content: center; align-items: center;
        }

        /* [1층~4층 배경 및 캐릭터] */
        .layer-bottom-bg { z-index: 1; }
        .bg-img-bottom { width: 100%; height: 100%; object-fit: cover; object-position: center;}

        .layer-character { z-index: 2; }
        .char-silhouette {
            position: absolute; right: 0; bottom: 30;
            width: 65vw; height: 100vh;
            object-fit: cover; object-position: top;
            filter: brightness(0) blur(4px); opacity: 0.9;
        }
        .char-face {
            position: absolute; left: 51%; top: 51%;
            transform: translate(-50%, -50%);
            width: auto; height: auto; object-fit: cover;
        }

        .layer-red-line { z-index: 3;}
        .img-red-line { width: 100%; height: 100%; object-fit: cover; }

        .layer-top-bg { z-index: 4; }
        .bg-img-top { width: 100%; height: 100%; object-fit: cover; }

        /* [5층] UI */
        .layer-ui {
            z-index: 5;
            pointer-events: auto; 
            display: block; 
        }

        /* ★ [수정됨] 왼쪽 사이드바 컨테이너 
           - 위치: 네비게이션(60px) 아래 20px 띄우고 시작 (top: 80px)
           - 정렬: 세로(column) 정렬
        */
        .left-sidebar {
            position: absolute;
            
            /* [수정] px 대신 % 사용 */
            top: 5%;   /* 화면 높이의 15% 지점에서 시작 (네비게이션바 피해서) */
            left: 2%;   /* 화면 너비의 2% 지점에 위치 */
            
            display: flex;
            flex-direction: column; 
            gap: 2vh;   /* [수정] 버튼 사이 간격도 화면 높이(vh)에 따라 조절 */
            align-items: flex-start; 
        }
        /* 버튼 스타일 */
        /* 버튼 스타일 수정 */
        .custom-btn {
            width: auto; 
            height: auto;
            
            /* [추가] 화면이 작아도 버튼이 화면의 20%를 넘지 않게 제한 */
            max-width: 20vw;  
            /* [추가] 버튼 높이도 화면의 10%를 넘지 않게 제한 (선택사항) */
            max-height: 10vh; 
            
            cursor: pointer;
            transition: transform 0.2s;
            display: block;
        }
        .custom-btn:hover { transform: scale(1.00) translateX(10px); }

        /* D-DAY 스타일 (이제 사이드바 안에 들어감) */
        .d-day-box {
            font-family: 'Pretendard';
            margin-top: 3px; /* 버튼들과 약간 더 거리 두기 */
        }
        .d-day-count { 
            /* [수정] 50px -> 4vw (화면 너비의 4% 크기) */
            font-size: 4vw; 
            
            color: #e8e8e8; 
            text-shadow: 2px 2px 0 #000;
            font-weight: 900; 
            letter-spacing: -0.3vw; /* [수정] 자간도 비율로 설정 (-5px 대신) */
        }
        
        /* TARGET DAY 라벨도 비율로 */
        .d-day-label {
            font-size: 1vw; /* 화면 너비의 1% 크기 */
            color: #888;
            margin-bottom: -0.5vh;
        }
    </style>
</head>
<body>

    <div class="layer layer-bottom-bg">
        <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%86%E1%85%A2%E1%86%AB%E1%84%8B%E1%85%A1%E1%84%85%E1%85%A2%E1%84%87%E1%85%A2%E1%84%80%E1%85%A7%E1%86%BC.png?alt=media&token=076388e3-d5b5-4d05-86ff-dd7cd81b6567" class="bg-img-bottom">
    </div>

    <div class="layer layer-character">
        <img id="fullBodyImg" class="char-silhouette" style="display: none;">
        <img id="profileImg" class="char-face" style="display: none;">
    </div>

    <div class="layer layer-red-line">
        <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%88%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A1%E1%86%AB%E1%84%89%E1%85%A5%E1%86%AB.png?alt=media&token=eba65930-8ff1-4327-a66d-ef5b9bf73fe0" class="img-red-line">
    </div>

    <div class="layer layer-top-bg">
        <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%86%E1%85%A2%E1%86%AB%E1%84%8B%E1%85%B1%E1%86%BA%E1%84%87%E1%85%A2%E1%84%80%E1%85%A7%E1%86%BC.png?alt=media&token=99dc9328-9d4c-446d-b908-cd6fab4e5955" class="bg-img-top">
    </div>

    <div class="layer layer-ui">

        <div class="left-sidebar">
            
            <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%87%E1%85%A5%E1%84%90%E1%85%B3%E1%86%AB1.png?alt=media&token=7714fc5d-fa31-48d7-8062-58c65675ddd9" class="custom-btn" onclick="location.href='board.html'">
            <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%87%E1%85%A5%E1%84%90%E1%85%B3%E1%86%AB2.png?alt=media&token=fa8319e4-7b67-4053-9039-1980e840c69a" class="custom-btn" onclick="location.href='sub.html'">
            <img src="https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%87%E1%85%A5%E1%84%90%E1%85%B3%E1%86%AB3.png?alt=media&token=7510b0ae-e5f0-41b7-a3b8-9a26a4446586" class="custom-btn" onclick="location.href='vending.html'">

            <div class="d-day-box">
                <div class="d-day-label">생존자 조우까지</div>
                <div class="d-day-count" id="dDayDisplay">D - 00</div>
            </div>

        </div>

    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
            authDomain: "cheongjuca.firebaseapp.com",
            databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
            projectId: "cheongjuca",
            appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        window.onload = function() {
            const status = localStorage.getItem("loginStatus");
            if (!status || (status !== "success" && status !== "admin")) {
                alert("로그인이 필요합니다."); location.href = "index.html"; return;
            }
            
            const nick = localStorage.getItem("userNick");
            const badge = document.getElementById("userBadge");
            if (badge && nick) {
                badge.innerText = (status === "admin") ? `[관리자]` : `[${nick}]`;
                badge.style.color = (status === "admin") ? "#f00" : "#ccc";
            }

            loadRandomSurvivor();
            calculateCountdown();
        };

        function loadRandomSurvivor() {
            const fullBody = document.getElementById('fullBodyImg');
            const face = document.getElementById('profileImg');

            database.ref('users').once('value').then(snap => {
                const users = snap.val();
                if(!users) return;

                const validUsers = Object.values(users).filter(u => u.fullBodyImg);
                if (validUsers.length > 0) {
                    const target = validUsers[Math.floor(Math.random() * validUsers.length)];
                    
                    fullBody.src = target.fullBodyImg;
                    face.src = target.photoFace ? target.photoFace : target.fullBodyImg;
                    
                    fullBody.style.display = 'block';
                    face.style.display = 'block';
                }
            });
        }

        //0이 1월이고 1이 2월임
        function calculateCountdown() {
            const targetDate = new Date(2026, 0 , 31); 
            const today = new Date();
            const diffDays = Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
            
            const display = document.getElementById('dDayDisplay');
            if (diffDays > 0) display.innerText = `D - ${diffDays}`;
            else if (diffDays === 0) { display.innerText = "D - DAY"; display.style.color="red"; }
            else display.innerText = `D + ${Math.abs(diffDays)}`;
        }

        function logout() { localStorage.clear(); location.href='index.html'; }
    </script>
</body>
</html>