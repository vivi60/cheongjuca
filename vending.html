<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>êµ¬í˜• ìíŒê¸°</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script>
      // 1. Firebase ì„¤ì • (ê¸°ì¡´ ì„¤ì • ìœ ì§€)
      const firebaseConfig = {
        apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
        authDomain: "cheongjuca.firebaseapp.com",
        databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
        projectId: "cheongjuca",
        storageBucket: "cheongjuca.firebasestorage.app",
        messagingSenderId: "455437421321",
        appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
    </script>
    <style>
        .vending-container { width: 90%; max-width: 600px; margin: 50px auto; background: #222; padding: 30px; border: 5px solid #444; border-radius: 20px; text-align: center; color: white; font-family: 'SchoolSafeBoardMarker'; }
        .machine-screen { background: #002200; border: 3px solid #004400; padding: 15px; border-radius: 10px; color: #00ff00; margin-bottom: 25px; font-size: 18px; text-shadow: 0 0 5px #00ff00; }
        .vending-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .vending-item { background: #333; border: 2px solid #555; border-radius: 10px; padding: 15px; cursor: pointer; transition: 0.2s; }
        .vending-item:hover { border-color: #00ff00; transform: scale(1.02); }
        .price-tag { color: gold; font-size: 14px; margin-top: 5px; }
    </style>
</head>
<body style="background-color: #111;">
    <nav class="navbar">
        <div class="logo">OUT BREAK</div>
        <ul class="nav-links">
            <li><a href="main.html">í™ˆ</a></li>
            <li><a href="sub.html">ìƒì¡´ìëª©ë¡</a></li>
            <li><a href="board.html">ììœ ê²Œì‹œíŒ</a></li>
            <li><a href="quest.html">ì˜ë¢°ê²Œì‹œíŒ</a></li>
            <li><a href="game.html">ë‚šì‹œí„°</a></li>
            <li><a href="vending.html">ìíŒê¸°</a></li>
            <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </nav>

    <div class="vending-container">
        <h1 style="color: #888; margin-top: 0;">ğŸ¥« ë…¸í›„ëœ ìë™íŒë§¤ê¸°</h1>
        <div class="machine-screen">
            ì†Œì§€ ê¸ˆì•¡: <span id="displayMoney">0</span> G<br>
            <span style="font-size: 14px;">[ ì”ì•¡ í™•ì¸ ì™„ë£Œ... ì„ íƒ ëŒ€ê¸° ì¤‘ ]</span>
        </div>
        
        <div class="vending-grid">
            <div class="vending-item" onclick="buyVending('ì—ë„ˆì§€ë“œë§í¬', 'ğŸ¥¤', 5)">
                <div style="font-size: 30px;">ğŸ¥¤</div>
                <div>ì—ë„ˆì§€ë“œë§í¬</div>
                <div class="price-tag">5 G</div>
            </div>
            <div class="vending-item" onclick="buyVending('ì´ˆì½”ìš°ìœ ', 'ğŸ«', 15)">
                <div style="font-size: 30px;">ğŸ«</div>
                <div>ì´ˆì½”ìš°ìœ </div>
                <div class="price-tag">15 G</div>
            </div>
            <div class="vending-item" onclick="buyVending('êµ¬ê¸‰ìƒì', 'ğŸ“¦', 50)">
                <div style="font-size: 30px;">ğŸ“¦</div>
                <div>êµ¬ê¸‰ìƒì</div>
                <div class="price-tag">50 G</div>
            </div>
        </div>
        <button onclick="location.href='main.html'" style="margin-top: 30px; background: none; border: 1px solid #555; color: #888; cursor: pointer;">[ ëŒì•„ê°€ê¸° ]</button>
    </div>

    <script>
        // ë‹‰ë„¤ì„ ëŒ€ì‹  ë¡œê·¸ì¸ ì‹œ ì €ì¥ëœ IDë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤
        const myID = localStorage.getItem("loginID") || localStorage.getItem("userNick");
        let money = 0;

        // ì‹¤ì‹œê°„ ëˆ ì •ë³´ ë¡œë“œ
        if (myID) {
            database.ref('users/' + myID).on('value', (snapshot) => {
                money = snapshot.val()?.money || 0;
                document.getElementById('displayMoney').innerText = money;
            });
        }

        function buyVending(name, icon, price) {
            if (!myID) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            if (money < price) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            
            if (confirm(`[${name}]ì„(ë¥¼) êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // 1. ì¸ë²¤í† ë¦¬ì— ì¶”ê°€í•  ì•„ì´í…œ ê°ì²´ (ë´‡ ì—°ë™ ê·œê²©)
                const newItem = {
                    name: name,
                    icon: icon,
                    type: "ì†Œë¹„",
                    source: "ì›¹ìíŒê¸°"
                };

                // 2. ëˆ ì°¨ê° ë° ì¸ë²¤í† ë¦¬ ì¶”ê°€ë¥¼ ë™ì‹œì— ì²˜ë¦¬
                const updates = {};
                updates[`users/${myID}/money`] = money - price;

                // Firebaseì˜ pushë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë²¤í† ë¦¬ì— ìƒˆ ì•„ì´í…œì„ ì¶”ê°€í•©ë‹ˆë‹¤
                database.ref(`users/${myID}/inventory`).push(newItem).then(() => {
                    database.ref().update(updates);
                    alert(`${name} êµ¬ë§¤ ì™„ë£Œ!`);
                }).catch(err => {
                    alert("êµ¬ë§¤ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    console.error(err);
                });
            }
        }

        function logout() {
            localStorage.clear();
            location.href = "index.html";
        }
    </script>
</body>
</html>