<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹ í˜• ìíŒê¸°</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Noto+Sans+KR:wght@400;700&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        /* =========================================
           [ì „ì²´ ë ˆì´ì•„ì›ƒ]
           ========================================= */
        body {
            margin: 0; padding: 0;
            background-color: #222;
            color: #333;
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            user-select: none;
        }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #333 0%, #111 100%);
            z-index: -2;
        }

        /* --- [í—¤ë” ë„¤ë¹„ê²Œì´ì…˜] --- */
        .top-header-bar {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 60px;
            background-color: #1a1a1a;
            border-bottom: 4px solid #535353;
            box-shadow: 0 5px 15px rgba(0,0,0,0.9);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box; z-index: 2000;
        }

        .header-logo {
            font-family: 'Black Ops One', cursive;
            font-size: 24px; color: #efefef; text-decoration: none;
            text-shadow: 2px 2px 0px #000; cursor: pointer; letter-spacing: 1px;
        }

        .hamburger-btn {
            background: none; border: none; cursor: pointer; padding: 5px;
            display: flex; flex-direction: column; gap: 5px;
        }
        .hamburger-line {
            width: 30px; height: 4px; background-color: #efefef; border-radius: 2px; transition: 0.3s;
        }
        .hamburger-btn:hover .hamburger-line { background-color: #aaa; }

        .nav-dropdown {
            display: none; position: absolute; top: 60px; right: 0; width: 220px;
            background-color: #222; border: 2px solid #535353; border-top: none;
            box-shadow: 0 10px 20px rgba(0,0,0,1); z-index: 10000;
        }
        .nav-item { 
            display: block; padding: 15px; color: #ccc; text-decoration: none; 
            font-size: 14px; border-bottom: 1px solid #444; font-family: 'Share Tech Mono', monospace;
        }
        .nav-item:hover { background-color: #535353; color: #fff; font-weight: bold; }
        .logout-item { color: #ff6b6b; font-weight: bold; }


        /* --- [ì‹ í˜• ìíŒê¸° ë³¸ì²´] --- */
        .vending-machine {
            margin-top: 100px;
            margin-bottom: 50px;
            width: 90%; max-width: 1000px;
            background: #e0e0e0;
            border: 1px solid #999;
            border-radius: 10px;
            box-shadow: 
                inset 0 0 20px rgba(255,255,255,0.5), 
                10px 10px 30px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
            display: flex; flex-direction: column; gap: 20px;
        }

        .machine-top {
            background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .machine-brand {
            font-size: 24px; font-weight: bold; color: #535353; letter-spacing: -1px; font-style: italic;
        }
        .credit-display {
            background: #222; color: rgb(255, 196, 0);
            font-family: 'VT323', monospace; font-size: 28px;
            padding: 5px 15px; border-radius: 4px;
            border: 2px solid #555; box-shadow: inset 0 0 5px #000;
        }

        .glass-window {
            background: #f0f8ff; border: 10px solid #ccc; border-radius: 5px;
            padding: 20px; box-shadow: inset 0 5px 15px rgba(0,0,0,0.2);
            min-height: 500px; position: relative;
        }
        .glass-window::after {
            content: ""; position: absolute; top: 0; right: 0; width: 40%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-20deg); pointer-events: none;
        }

        .product-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            position: relative; z-index: 1;
            padding-top: 45px;
        }

        .product-slot {
            background: transparent;
            display: flex; flex-direction: column; align-items: center;
            padding: 10px;
            border-bottom: 2px solid #ddd;
        }

        /* [ìˆ˜ì •] ì´ë¯¸ì§€ìš© ìŠ¤íƒ€ì¼ë¡œ ë³€ê²½ */
        .product-icon {
            width: 80px; /* ì´ë¯¸ì§€ ë„ˆë¹„ */
            height: 80px; /* ì´ë¯¸ì§€ ë†’ì´ */
            margin-bottom: 10px;
            object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì¹¸ì— ë§ì¶¤ */
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3)); /* ê·¸ë¦¼ì íš¨ê³¼ */
            transition: transform 0.2s;
        }
        .product-slot:hover .product-icon { transform: scale(1.1) rotate(5deg); }

        .product-name {
            font-size: 14px; font-weight: bold; color: #333;
            text-align: center; margin-bottom: 5px;
            height: 40px; line-height: 1.2; display: flex; align-items: center;
        }

        /* [ìˆ˜ì •] ëª¨ë“  ë²„íŠ¼ ë””ìì¸ (ê¸°ë³¸: ì§„íšŒìƒ‰ -> í˜¸ë²„: ë¹¨ê°•) */
        .buy-btn, .buy-btn.expensive {
            background: #333333; /* ê¸°ë³¸: ì§„í•œ íšŒìƒ‰ */
            color: white; 
            border: none; 
            border-radius: 20px;
            padding: 5px 15px; 
            font-size: 14px; 
            font-weight: bold; 
            font-family: 'Noto Sans KR';
            cursor: pointer; 
            
            /* ê·¸ë¦¼ì: ë” ì–´ë‘ìš´ ê²€ì • ê³„ì—´ */
            box-shadow: 0 3px 0 #000000, 0 5px 5px rgba(0,0,0,0.3); 
            transition: 0.2s; 
            width: 100%;
        }

        /* ë§ˆìš°ìŠ¤ ì˜¬ë ¸ì„ ë•Œ (Hover) -> ë¹¨ê°„ìƒ‰ (#ff0000) */
        .buy-btn:hover, .buy-btn.expensive:hover {
            background: #ff0000; /* ê°•ë ¬í•œ ë¹¨ê°• */
            /* ê·¸ë¦¼ìë„ ì§„í•œ ë¶‰ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
            box-shadow: 0 3px 0 #990000, 0 5px 5px rgba(0,0,0,0.5); 
        }
        
        /* ëˆŒë €ì„ ë•Œ (Click) -> ì›€í‘¹ ë“¤ì–´ê° */
        .buy-btn:active, .buy-btn.expensive:active { 
            transform: translateY(3px); 
            box-shadow: 0 0 0 #000000, inset 0 2px 5px rgba(0,0,0,0.2); 
        }


        .machine-bottom {
            height: 80px; background: #ccc; border-radius: 0 0 5px 5px;
            border-top: 1px solid #999;
            display: flex; align-items: center; justify-content: center;
        }
        .pickup-box {
            width: 60%; height: 50px; background: #111; border-radius: 5px;
            border-bottom: 2px solid #444; display: flex; align-items: center; justify-content: center;
            color: #555; font-size: 14px; box-shadow: inset 0 5px 10px #000;
        }

    </style>
</head>
<body>

    <header class="top-header-bar">
        <a href="main.html" class="header-logo">OUTBREAK</a>

        <button class="hamburger-btn" id="hamburgerBtn">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </button>

        <div class="nav-dropdown" id="menuList">
            <a href="game.html" class="nav-item">ê³ ì¥ë‚œ ìíŒê¸°</a>
            <a href="shop.html" class="nav-item">êµí™˜ì†Œ</a>
            <a href="vending.html" class="nav-item">ì‹ í˜• ìíŒê¸°</a>
            <a href="#" onclick="logout()" class="nav-item logout-item">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </header>

    <div class="vending-machine">
        
        <div class="machine-top">
            <div class="machine-brand">Cheongsong University</div>
            <div class="credit-display">
                <span style="font-size:14px; color:#aaa; margin-right:5px;">CREDIT:</span>
                <span id="displayMoney">0</span>
            </div>
        </div>

        <div class="glass-window">
            <div class="product-grid" id="gridArea">
            </div>
        </div>

        <div class="machine-bottom">
            <div class="pickup-box">PUSH (ìƒí’ˆ ë°°ì¶œêµ¬)</div>
        </div>

    </div>

    <script src="script.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
            authDomain: "cheongjuca.firebaseapp.com",
            databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
            projectId: "cheongjuca",
            storageBucket: "cheongjuca.firebasestorage.app",
            messagingSenderId: "455437421321",
            appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const myID = localStorage.getItem("loginID");
        const myNick = localStorage.getItem("userNick") || "ìƒì¡´ì";
        let money = 0;

        function isOperatingTime() {
    const h = new Date().getHours();
    // ì˜¤ì „ 2ì‹œ(2)ë¶€í„° ì˜¤ì „ 8ì‹œ(8) ì‚¬ì´ë©´ false ë°˜í™˜
    return !(h >= 2 && h < 8);
}

        // â˜… [ìˆ˜ì •] ì´ëª¨ì§€ ëŒ€ì‹  ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”!
        // ì˜ˆì‹œ: icon: "https://i.imgur.com/example.png"
        const products = [
            { id: 1, name: "ë§ˆë²•ì˜ì†Œë¼ê³ ë™", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%89%E1%85%A9%E1%84%85%E1%85%A1.png?alt=media&token=749dfb72-6c7f-40f8-9842-14fc9e080fdc", price: 500, type: "item" },
            { id: 2, name: "ëª°ë˜ì˜¨ì†ë‹˜", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%86%E1%85%A9%E1%86%AF%E1%84%85%E1%85%A2%E1%84%8E%E1%85%A1%E1%86%BD%E1%84%8B%E1%85%A1%E1%84%8B%E1%85%A9%E1%86%AB%E1%84%89%E1%85%A9%E1%86%AB%E1%84%82%E1%85%B5%E1%86%B7.png?alt=media&token=eff86ac8-7b89-465c-9dd7-34804223d9a7", price: 2000, type: "secret" },
            { id: 3, name: "ì§€ë„", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%8D%E1%85%B5%E1%86%BD%E1%84%8B%E1%85%A5%E1%84%8C%E1%85%B5%E1%86%AB%20%E1%84%8C%E1%85%B5%E1%84%83%E1%85%A9.png?alt=media&token=13af5706-a063-433f-be93-63052acbc341", price: 4000, type: "item" },
            { id: 4, name: "ì†Œì£¼", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%89%E1%85%A9%E1%84%8C%E1%85%AE.png?alt=media&token=4c327d27-e261-4bdd-beb5-213d1e9b4a41", price: 4000, type: "item" },
            { id: 5, name: "ì—ë„ˆì§€ë°”", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%8B%E1%85%A6%E1%84%82%E1%85%A5%E1%84%8C%E1%85%B5%E1%84%87%E1%85%A1.png?alt=media&token=da34843c-25e5-47fb-970d-bbcf77c545f5", price: 5000, type: "item" },
            { id: 6, name: "ë„ì‹œë½", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%83%E1%85%A9%E1%84%89%E1%85%B5%E1%84%85%E1%85%A1%E1%86%A8.png?alt=media&token=d4a25fd4-53e6-4c0b-8f5a-571f87e4df4d", price: 8000, type: "item" },
            { id: 7, name: "ëœë¤ë°•ìŠ¤", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658", price: 5000, type: "random", pool: "machine" },
            { id: 8, name: "íŠ¹ì „í‚¤íŠ¸", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%82%E1%85%A6%E1%84%86%E1%85%A9%E1%84%82%E1%85%A1%E1%86%AB%20%E1%84%87%E1%85%A1%E1%86%A8%E1%84%89%E1%85%B3.png?alt=media&token=c687b672-1b7e-44ba-b534-782c8916769c", price: 15000, type: "random", pool: "box" },
            { id: 9, name: "ë„ë°•", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%82%E1%85%A2%20%E1%84%83%E1%85%A9%E1%86%AB!!.png?alt=media&token=a0a5b945-a2e5-4d5e-93f7-9b9ed6bd29a7", price: 0, type: "gamble" },
            { id: 10, name: "ì¹œêµ¬ì¶”ê°€", icon: "https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%8E%E1%85%B5%E1%86%AB%E1%84%80%E1%85%AE%E1%84%8E%E1%85%AE%E1%84%80%E1%85%A1.png?alt=media&token=818e9bb1-ae36-4e87-b5be-18a73d224f65", price: 10000, type: "custom" }
        ];

        // ëœë¤ ë½‘ê¸° ì•„ì´í…œë“¤ì˜ ì´ë¯¸ì§€ë„ ì„¤ì •í•˜ì„¸ìš”
        const randomPools = {
            //ëœë¤ë°•ìŠ¤
            "machine": [
                {name:"í™•ì„±ê¸°", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì‡ ì§€ë ›ëŒ€", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì•¼êµ¬ë°°íŠ¸", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ëª©ê²€", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ê°€ì¡±ì‚¬ì§„", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ìŠ¤ì¼€ì´íŠ¸ë³´ë“œ", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ë°§ì¤„", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì‹ ë¶„ì¦", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì½˜ë”", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ê°œì‚¬ë£Œ", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"íƒ„ì°½ ì—†ëŠ” ê¶Œì´", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ìœ„ìŠ¤í‚¤", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"íœ´ëŒ€ì „í™”", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì—¬ìì•„ì´ ì¸í˜•", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ìŒì‹ëª¨í˜•", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"MP3", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ë…¸íŠ¸ì™€íœ", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì² ê°€ë°©", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ë„ë¼", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"í¬ë„ë‹¹ ì‚¬íƒ•", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ì‘ê¸‰í‚¤íŠ¸", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 
                {name:"ë¬¼ë³‘", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/image%2F%E1%84%80%E1%85%B5%E1%84%80%E1%85%A8%20%E1%84%80%E1%85%A9%E1%84%8C%E1%85%A1%E1%86%BC.gif?alt=media&token=9371fd73-72f4-4725-8fed-2f4849047658"}, 

            ],
            //íŠ¹ì „í‚¤íŠ¸
            "box": [
                {name:"ê°•ë‚˜ë¦¬ ë§Œì¥¬", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/shop%2F%E1%84%80%E1%85%A1%E1%86%BC%E1%84%82%E1%85%A1%E1%84%85%E1%85%B5.png?alt=media&token=5b2d6280-184a-4630-8a65-1a254068eafe"}, 
                {name:"ë²”ì§€íƒœ ë§Œì¥¬", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/shop%2F%E1%84%87%E1%85%A5%E1%86%B7%E1%84%8C%E1%85%B5%E1%84%90%E1%85%A2.png?alt=media&token=fde9516d-0f06-4239-86e6-4171135dd634"}, 
                {name:"ê°•ì´ˆì•„ ë§Œì¥¬", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/shop%2F%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8E%E1%85%A9%E1%84%8B%E1%85%A1.png?alt=media&token=a4bbda20-fbfc-4847-a14b-77666f571b17"},
                {name:"ê°•ì§„í˜ ë§Œì¥¬", icon:"https://firebasestorage.googleapis.com/v0/b/cheongjuca.firebasestorage.app/o/shop%2F%E1%84%80%E1%85%A1%E1%86%BC%E1%84%8C%E1%85%B5%E1%86%AB%E1%84%92%E1%85%A7%E1%86%A8.png?alt=media&token=b6813277-1750-4aba-9171-7b9d32bcd439"},
            ]
        };

        window.onload = function() {
            setupNav();
            if (myID) {
                database.ref('users/' + myID).on('value', (snapshot) => {
                    money = snapshot.val()?.money || 0;
                    document.getElementById('displayMoney').innerText = money.toLocaleString();
                });
            } else {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); location.href = "index.html";
            }
            renderGrid();
        };

        function renderGrid() {
            const grid = document.getElementById('gridArea');
            grid.innerHTML = "";
            
            products.forEach(p => {
                let btnText = `${p.price} G`;
                let btnClass = "buy-btn";
                
                if (p.price >= 300) btnClass += " expensive"; 
                if (p.type === 'gamble') { btnText = "BETTING"; btnClass = "buy-btn expensive"; }

                grid.innerHTML += `
                    <div class="product-slot">
                        <img src="${p.icon}" class="product-icon" alt="${p.name}" onerror="this.src='https://via.placeholder.com/80?text=No+Img'">
                        
                        <div class="product-name">${p.name}</div>
                        <button class="${btnClass}" onclick="purchase('${p.name}', '${p.icon}', ${p.price}, '${p.type}', '${p.pool || ''}')">
                            ${btnText}
                        </button>
                    </div>
                `;
            });
        }

        async function purchase(name, icon, defaultPrice, type, poolName) {
            if (!myID) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            let finalPrice = defaultPrice;
if (!isOperatingTime()) {
        alert("ì§€ê¸ˆì€ ìíŒê¸° íœ´ì‹ ì‹œê°„ì…ë‹ˆë‹¤. ì˜¤ì „ 8ì‹œì— ë‹¤ì‹œ ì™€ì£¼ì„¸ìš”!");
        return;
    }
            // 1. ë„ë°•ì¼ ê²½ìš° ê¸ˆì•¡ ì…ë ¥ ë°›ê¸°
            if (type === 'gamble') {
                const inputVal = prompt(`[${name}]\në³´ìœ  ê¸ˆì•¡: ${money}G\nì–¼ë§ˆë¥¼ ê±°ì‹œê² ìŠµë‹ˆê¹Œ?`);
                if (inputVal === null) return; 
                finalPrice = parseInt(inputVal);
                if (isNaN(finalPrice) || finalPrice <= 0) return alert("ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
                if (money < finalPrice) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                if (!confirm(`${finalPrice}Gë¥¼ ê±¸ê³  ë„ë°•ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            } else {
                // ì¼ë°˜ êµ¬ë§¤ í™•ì¸
                if (money < finalPrice) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                if (!confirm(`[${name}] - ${finalPrice}G\nêµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            }

            // ëˆ ì°¨ê° ì¤€ë¹„
            const updates = {};
            updates[`users/${myID}/money`] = money - finalPrice;
            
            // --- íƒ€ì…ë³„ ì²˜ë¦¬ ë° ë§ˆìŠ¤í† ëˆ ì•Œë¦¼ ì „ì†¡ ---

            if (type === 'secret') {
                const postsSnap = await database.ref('posts').once('value');
                const posts = postsSnap.val();
                if (!posts) return alert("ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
                const keys = Object.keys(posts);
                const targetPost = posts[keys[Math.floor(Math.random() * keys.length)]];
                
                let writerName = "ì•Œ ìˆ˜ ì—†ìŒ";
                const authorSnap = await database.ref('users/' + targetPost.authorID).once('value');
                
                if (authorSnap.exists()) {
                    const userData = authorSnap.val();
                    writerName = userData.nickname || userData.nick || "ì•Œ ìˆ˜ ì—†ìŒ";
                }
                
                await database.ref().update(updates);
                
                // [ë§ˆìŠ¤í† ëˆ ì•Œë¦¼]
                if (typeof postToMastodon === "function") {
                    // 1. êµ¬ë§¤ ì‚¬ì‹¤ ì•Œë¦¼
                    postToMastodon(`[ëª°ë˜ ì°¾ì•„ì˜¨ ì†ë‹˜] ${myNick}ë‹˜ì´ ê±°ê¸ˆì„ ë“¤ì—¬ ë¹„ë°€ ì •ë³´ë¥¼ êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.`);
                    
                    // â–¼â–¼â–¼ [ì¶”ê°€ëœ ë¶€ë¶„] ì •ë³´ ë‚´ìš©ë„ ë§ˆìŠ¤í† ëˆìœ¼ë¡œ ì „ì†¡ â–¼â–¼â–¼
                    postToMastodon(`[ë¹„ë°€ ì •ë³´ ê³µê°œ]\nê¸€ ì œëª©: ${targetPost.title}\nì‘ì„±ì: ${writerName}`);
                }
                
                // í™”ë©´ ì•Œë¦¼
                alert(`[ë¹„ë°€ ì •ë³´]\nê¸€ ì œëª©: ${targetPost.title}\nì‘ì„±ì: ${writerName}`);
            }

            else if (type === 'item') {
                // â–¼â–¼â–¼ [ìˆ˜ì •ëœ ë¡œì§] ì§€ë„ëŠ” ì¸ë²¤í† ë¦¬ì— ë„£ì§€ ì•Šê³  ì¦‰ì‹œ ì‹¤í–‰ â–¼â–¼â–¼
                if (name === "ì§€ë„") {
                    const mapImages = [
                        "", 
                        ""
                    ];
                    const mapImg = mapImages[Math.floor(Math.random() * mapImages.length)];
                    
                    // ëˆë§Œ ì°¨ê°í•˜ê³  ì¸ë²¤í† ë¦¬ pushëŠ” í•˜ì§€ ì•ŠìŒ
                    await database.ref().update(updates);
                    
                    // ë§ˆìŠ¤í† ëˆ ì•Œë¦¼
                    if (typeof postToMastodon === "function") {
                        postToMastodon(`[ì§€ë„] ${myNick}ë‹˜ì´ ì°¢ì–´ì§„ ì§€ë„ë¥¼ êµ¬ë§¤í•˜ì˜€ìŠµë‹ˆë‹¤.`, icon);
                    }
                    
                    alert("ğŸ—ºï¸ ì§€ë„ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤!");
                    window.open(mapImg, '_blank'); // ìƒˆ ì°½ìœ¼ë¡œ ì§€ë„ ì´ë¯¸ì§€ ì—´ê¸°
                } 
                else {
                    // ì§€ë„ê°€ ì•„ë‹Œ ì¼ë°˜ ì•„ì´í…œë“¤ì€ ê¸°ì¡´ì²˜ëŸ¼ ì¸ë²¤í† ë¦¬ì— ì €ì¥
                    await database.ref(`users/${myID}/inventory`).push({ name, icon, type: "ì†Œë¹„" });
                    await database.ref().update(updates);
                    
                    if (typeof postToMastodon === "function") {
                        postToMastodon(`[ìíŒê¸°] ${myNick}ë‹˜ì´ [${name}]ì„(ë¥¼) êµ¬ë§¤í–ˆìŠµë‹ˆë‹¤.`, icon);
                    }
                    alert(`ëœì»¹! [${name}] ë°°ì¶œ ì™„ë£Œ!`);
                }
                // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²
            }
            else if (type === 'random') {
                const pool = randomPools[poolName];
                const item = pool[Math.floor(Math.random() * pool.length)];
                await database.ref(`users/${myID}/inventory`).push({ name: item.name, icon: item.icon, type: "ì†Œë¹„" });
                await database.ref().update(updates);
                
                // [ë§ˆìŠ¤í† ëˆ ì•Œë¦¼] ëœë¤ ë½‘ê¸° ê²°ê³¼
                if (typeof postToMastodon === "function") {
                    postToMastodon(`ğŸ² [ë½‘ê¸°] ${myNick}ë‹˜ì´ ëœë¤ë°•ìŠ¤ì—ì„œ [${item.name}]ì„(ë¥¼) ë½‘ì•˜ìŠµë‹ˆë‹¤!`, item.icon);
                }

                alert(`ëœì»¹! ëœë¤ë°•ìŠ¤ì—ì„œ [${item.name}] íšë“!`);
            } 
            else if (type === 'gamble') {
                const isWin = Math.random() >= 0.5;
                let msg = "";
                
                if (isWin) {
                    updates[`users/${myID}/money`] = money + finalPrice; 
                    msg = `ğŸ‰ ë‹¹ì²¨! ${finalPrice*2}G íšë“!`;
                    
                    // [ë§ˆìŠ¤í† ëˆ ì•Œë¦¼] ë„ë°• ìŠ¹ë¦¬
                    if (typeof postToMastodon === "function") {
                        postToMastodon(`ğŸ° [ë„ë°•] ${myNick}ë‹˜ì´ ${finalPrice}Gë¥¼ ê±¸ê³  ìŠ¹ë¦¬í•˜ì—¬ ëˆì„ ë¶ˆë ¸ìŠµë‹ˆë‹¤! (+${finalPrice}G)`);
                    }
                } else {
                    msg = `ğŸ’¸ ê½... ëˆì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤.`;
                    
                    // [ë§ˆìŠ¤í† ëˆ ì•Œë¦¼] ë„ë°• íŒ¨ë°°
                    if (typeof postToMastodon === "function") {
                        postToMastodon(`ğŸ’¸ [ë„ë°•] ${myNick}ë‹˜ì´ ${finalPrice}Gë¥¼ ê±¸ì—ˆì§€ë§Œ ì „ì•¡ íƒ•ì§„í–ˆìŠµë‹ˆë‹¤...`);
                    }
                }
                await database.ref().update(updates);
                alert(msg);
            } 
            else if (type === 'custom') {
                const customName = prompt("ì›í•˜ëŠ” ì•…ì„¸ì‚¬ë¦¬ ì´ë¦„:");
                if (!customName) return;
                await database.ref(`users/${myID}/inventory`).push({ name: customName, icon: icon });
                await database.ref(`users/${myID}/inventory`).push({ name: customName, icon: icon });
                await database.ref().update(updates);
                
                // [ë§ˆìŠ¤í† ëˆ ì•Œë¦¼] ì»¤ìŠ¤í…€ ì•„ì´í…œ
                if (typeof postToMastodon === "function") {
                    postToMastodon(`âœ¨ [ì œì‘] ${myNick}ë‹˜ì´ [${customName}]ì„(ë¥¼) ì£¼ë¬¸ ì œì‘í–ˆìŠµë‹ˆë‹¤.`, icon);
                }

                alert(`${customName} 2ê°œ íšë“!`);
            }
        }

        function setupNav() {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const menuList = document.getElementById('menuList');
            hamburgerBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                menuList.style.display = (menuList.style.display === 'block') ? 'none' : 'block';
            });
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.nav-dropdown') && !e.target.closest('#hamburgerBtn')) {
                    menuList.style.display = 'none';
                }
            });
        }
        function logout() { localStorage.clear(); location.href = "index.html"; }
    </script>
</body>
</html>