<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì‹ í˜• ìíŒê¸° (VENDING V2)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Noto+Sans+KR:wght@400;700&family=VT323&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        /* =========================================
           [ì „ì²´ ë ˆì´ì•„ì›ƒ]
           ========================================= */
        body {
            margin: 0; padding: 0;
            background-color: #222;
            color: #333;
            font-family: 'Noto Sans KR', sans-serif;
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            user-select: none;
        }

        body::before {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at center, #333 0%, #111 100%);
            z-index: -2;
        }

        /* --- [í—¤ë” ë„¤ë¹„ê²Œì´ì…˜] --- */
        .top-header-bar {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 60px;
            background-color: #1a1a1a;
            border-bottom: 4px solid #535353;
            box-shadow: 0 5px 15px rgba(0,0,0,0.9);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 20px; box-sizing: border-box; z-index: 2000;
        }

        .header-logo {
            font-family: 'Black Ops One', cursive;
            font-size: 24px; color: #efefef; text-decoration: none;
            text-shadow: 2px 2px 0px #000; cursor: pointer; letter-spacing: 1px;
        }

        .hamburger-btn {
            background: none; border: none; cursor: pointer; padding: 5px;
            display: flex; flex-direction: column; gap: 5px;
        }
        .hamburger-line {
            width: 30px; height: 4px; background-color: #efefef; border-radius: 2px; transition: 0.3s;
        }
        .hamburger-btn:hover .hamburger-line { background-color: #aaa; }

        .nav-dropdown {
            display: none; position: absolute; top: 60px; right: 0; width: 220px;
            background-color: #222; border: 2px solid #535353; border-top: none;
            box-shadow: 0 10px 20px rgba(0,0,0,1); z-index: 10000;
        }
        .nav-item { 
            display: block; padding: 15px; color: #ccc; text-decoration: none; 
            font-size: 14px; border-bottom: 1px solid #444; font-family: 'Share Tech Mono', monospace;
        }
        .nav-item:hover { background-color: #535353; color: #fff; font-weight: bold; }
        .logout-item { color: #ff6b6b; font-weight: bold; }


        /* --- [ì‹ í˜• ìíŒê¸° ë³¸ì²´] --- */
        .vending-machine {
            margin-top: 100px;
            margin-bottom: 50px;
            width: 90%; max-width: 1000px;
            background: #e0e0e0;
            border: 1px solid #999;
            border-radius: 10px;
            box-shadow: 
                inset 0 0 20px rgba(255,255,255,0.5), 
                10px 10px 30px rgba(0,0,0,0.5);
            padding: 20px;
            position: relative;
            display: flex; flex-direction: column; gap: 20px;
        }

        .machine-top {
            background: #fff; border: 1px solid #ccc; border-radius: 5px; padding: 15px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .machine-brand {
            font-size: 24px; font-weight: bold; color: #0056b3; letter-spacing: -1px; font-style: italic;
        }
        .credit-display {
            background: #222; color: #0f0;
            font-family: 'VT323', monospace; font-size: 28px;
            padding: 5px 15px; border-radius: 4px;
            border: 2px solid #555; box-shadow: inset 0 0 5px #000;
        }

        .glass-window {
            background: #f0f8ff; border: 10px solid #ccc; border-radius: 5px;
            padding: 20px; box-shadow: inset 0 5px 15px rgba(0,0,0,0.2);
            min-height: 500px; position: relative;
        }
        .glass-window::after {
            content: ""; position: absolute; top: 0; right: 0; width: 40%; height: 100%;
            background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
            transform: skewX(-20deg); pointer-events: none;
        }

        .product-grid {
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            position: relative; z-index: 1;
        }

        .product-slot {
            background: transparent;
            display: flex; flex-direction: column; align-items: center;
            padding: 10px;
            border-bottom: 2px solid #ddd;
        }

        /* [ìˆ˜ì •] ì´ë¯¸ì§€ìš© ìŠ¤íƒ€ì¼ë¡œ ë³€ê²½ */
        .product-icon {
            width: 80px; /* ì´ë¯¸ì§€ ë„ˆë¹„ */
            height: 80px; /* ì´ë¯¸ì§€ ë†’ì´ */
            margin-bottom: 10px;
            object-fit: contain; /* ë¹„ìœ¨ ìœ ì§€í•˜ë©° ì¹¸ì— ë§ì¶¤ */
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3)); /* ê·¸ë¦¼ì íš¨ê³¼ */
            transition: transform 0.2s;
        }
        .product-slot:hover .product-icon { transform: scale(1.1) rotate(5deg); }

        .product-name {
            font-size: 14px; font-weight: bold; color: #333;
            text-align: center; margin-bottom: 5px;
            height: 40px; line-height: 1.2; display: flex; align-items: center;
        }

        .buy-btn {
            background: linear-gradient(to bottom, #007bff, #0056b3);
            color: white; border: none; border-radius: 20px;
            padding: 5px 15px; font-size: 14px; font-weight: bold; font-family: 'Noto Sans KR';
            cursor: pointer; box-shadow: 0 3px 0 #004085, 0 5px 5px rgba(0,0,0,0.2);
            transition: 0.1s; width: 100%;
        }
        .buy-btn:active { transform: translateY(3px); box-shadow: 0 0 0 #004085, inset 0 2px 5px rgba(0,0,0,0.2); }
        .buy-btn.expensive {
            background: linear-gradient(to bottom, #dc3545, #a71d2a);
            box-shadow: 0 3px 0 #721c24, 0 5px 5px rgba(0,0,0,0.2);
        }
        .buy-btn.expensive:active { box-shadow: 0 0 0 #721c24; }

        .machine-bottom {
            height: 80px; background: #ccc; border-radius: 0 0 5px 5px;
            border-top: 1px solid #999;
            display: flex; align-items: center; justify-content: center;
        }
        .pickup-box {
            width: 60%; height: 50px; background: #111; border-radius: 5px;
            border-bottom: 2px solid #444; display: flex; align-items: center; justify-content: center;
            color: #555; font-size: 14px; box-shadow: inset 0 5px 10px #000;
        }

    </style>
</head>
<body>

    <header class="top-header-bar">
        <a href="main.html" class="header-logo">OUTBREAK</a>

        <button class="hamburger-btn" id="hamburgerBtn">
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
            <div class="hamburger-line"></div>
        </button>

        <div class="nav-dropdown" id="menuList">
            <a href="game.html" class="nav-item">ê³ ì¥ë‚œ ìíŒê¸°</a>
            <a href="shop.html" class="nav-item">êµí™˜ì†Œ</a>
            <a href="vending.html" class="nav-item">ì‹ í˜• ìíŒê¸°</a>
            <a href="#" onclick="logout()" class="nav-item logout-item">ë¡œê·¸ì•„ì›ƒ</a>
        </div>
    </header>

    <div class="vending-machine">
        
        <div class="machine-top">
            <div class="machine-brand">Fresh & Supply</div>
            <div class="credit-display">
                <span style="font-size:14px; color:#aaa; margin-right:5px;">CREDIT:</span>
                <span id="displayMoney">0</span>
            </div>
        </div>

        <div class="glass-window">
            <div class="product-grid" id="gridArea">
            </div>
        </div>

        <div class="machine-bottom">
            <div class="pickup-box">PUSH (ìƒí’ˆ ë°°ì¶œêµ¬)</div>
        </div>

    </div>

    <script src="script.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
            authDomain: "cheongjuca.firebaseapp.com",
            databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
            projectId: "cheongjuca",
            storageBucket: "cheongjuca.firebasestorage.app",
            messagingSenderId: "455437421321",
            appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const myID = localStorage.getItem("loginID");
        const myNick = localStorage.getItem("userNick") || "ìƒì¡´ì";
        let money = 0;

        // â˜… [ìˆ˜ì •] ì´ëª¨ì§€ ëŒ€ì‹  ì´ë¯¸ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš”!
        // ì˜ˆì‹œ: icon: "https://i.imgur.com/example.png"
        const products = [
            { id: 1, name: "ë§ˆë²•ì˜ ì†Œë¼ê³ ë™", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 50, type: "item" },
            { id: 2, name: "ëª°ë˜ ì˜¨ ì†ë‹˜", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 300, type: "secret" },
            { id: 3, name: "ì°¢ì–´ì§„ ì§€ë„", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 100, type: "item" },
            { id: 4, name: "ì†Œì£¼", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 150, type: "item" },
            { id: 5, name: "ì—ë„ˆì§€ë°”", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 50, type: "item" },
            { id: 6, name: "ë„ì‹œë½", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 100, type: "item" },
            { id: 7, name: "ê¸°ê³„ ê³ ì¥", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 200, type: "random", pool: "machine" },
            { id: 8, name: "ë„¤ëª¨ë‚œ ë°•ìŠ¤", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 200, type: "random", pool: "box" },
            { id: 9, name: "ë‚´ ëˆ!!", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 0, type: "gamble" },
            { id: 10, name: "ì¹œêµ¬ ì¶”ê°€", icon: "ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°", price: 500, type: "custom" }
        ];

        // ëœë¤ ë½‘ê¸° ì•„ì´í…œë“¤ì˜ ì´ë¯¸ì§€ë„ ì„¤ì •í•˜ì„¸ìš”
        const randomPools = {
            "machine": [
                {name:"ë…¹ìŠ¨ í†±ë‹ˆë°”í€´", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}, 
                {name:"ì „ì„  ë­‰ì¹˜", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}, 
                {name:"ìˆ˜ìƒí•œ ì¹©", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}
            ],
            "box": [
                {name:"ê³°ì¸í˜•", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}, 
                {name:"ë‚¡ì€ ì±…", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}, 
                {name:"í™©ê¸ˆ ì—´ì‡ ", icon:"ì´ë¯¸ì§€ì£¼ì†Œ_ì—¬ê¸°ì—_ë¶™ì—¬ë„£ê¸°"}
            ]
        };

        window.onload = function() {
            setupNav();
            if (myID) {
                database.ref('users/' + myID).on('value', (snapshot) => {
                    money = snapshot.val()?.money || 0;
                    document.getElementById('displayMoney').innerText = money.toLocaleString();
                });
            } else {
                alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."); location.href = "index.html";
            }
            renderGrid();
        };

        function renderGrid() {
            const grid = document.getElementById('gridArea');
            grid.innerHTML = "";
            
            products.forEach(p => {
                let btnText = `${p.price} G`;
                let btnClass = "buy-btn";
                
                if (p.price >= 300) btnClass += " expensive"; 
                if (p.type === 'gamble') { btnText = "BETTING"; btnClass = "buy-btn expensive"; }

                grid.innerHTML += `
                    <div class="product-slot">
                        <img src="${p.icon}" class="product-icon" alt="${p.name}" onerror="this.src='https://via.placeholder.com/80?text=No+Img'">
                        
                        <div class="product-name">${p.name}</div>
                        <button class="${btnClass}" onclick="purchase('${p.name}', '${p.icon}', ${p.price}, '${p.type}', '${p.pool || ''}')">
                            ${btnText}
                        </button>
                    </div>
                `;
            });
        }

        async function purchase(name, icon, defaultPrice, type, poolName) {
            if (!myID) return alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            let finalPrice = defaultPrice;

            if (type === 'gamble') {
                const inputVal = prompt(`[${name}]\në³´ìœ  ê¸ˆì•¡: ${money}G\nì–¼ë§ˆë¥¼ ê±°ì‹œê² ìŠµë‹ˆê¹Œ?`);
                if (inputVal === null) return; 
                finalPrice = parseInt(inputVal);
                if (isNaN(finalPrice) || finalPrice <= 0) return alert("ì˜¬ë°”ë¥¸ ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”.");
                if (money < finalPrice) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                if (!confirm(`${finalPrice}Gë¥¼ ê±¸ê³  ë„ë°•ì„ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            } else {
                if (money < finalPrice) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                if (!confirm(`[${name}] - ${finalPrice}G\nêµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            }

            const updates = {};
            updates[`users/${myID}/money`] = money - finalPrice;
            
            if (type === 'secret') {
                const postsSnap = await database.ref('posts').once('value');
                const posts = postsSnap.val();
                if (!posts) return alert("ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.");
                const keys = Object.keys(posts);
                const targetPost = posts[keys[Math.floor(Math.random() * keys.length)]];
                
                let realName = "ì•Œ ìˆ˜ ì—†ìŒ";
                const authorSnap = await database.ref('users/' + targetPost.authorID).once('value');
                if (authorSnap.exists()) realName = authorSnap.val().nick;
                
                await database.ref().update(updates);
                alert(`ğŸ•µï¸ [ë¹„ë°€ ì •ë³´]\nê¸€ ì œëª©: ${targetPost.title}\nì‘ì„±ì: ${realName}`);
            } 
            else if (type === 'item') {
                await database.ref(`users/${myID}/inventory`).push({ name, icon, type: "ì†Œë¹„" });
                await database.ref().update(updates);
                alert(`ëœì»¹! [${name}] ë°°ì¶œ ì™„ë£Œ!`);
            } 
            else if (type === 'random') {
                const pool = randomPools[poolName];
                const item = pool[Math.floor(Math.random() * pool.length)];
                await database.ref(`users/${myID}/inventory`).push({ name: item.name, icon: item.icon, type: "ì†Œë¹„" });
                await database.ref().update(updates);
                alert(`ëœì»¹! ëœë¤ë°•ìŠ¤ì—ì„œ [${item.name}] íšë“!`);
            } 
            else if (type === 'gamble') {
                const isWin = Math.random() >= 0.5;
                if (isWin) {
                    updates[`users/${myID}/money`] = money + finalPrice; 
                    alert(`ğŸ‰ ë‹¹ì²¨! ${finalPrice*2}G íšë“!`);
                } else {
                    alert(`ğŸ’¸ ê½... ëˆì„ ë¨¹ì—ˆìŠµë‹ˆë‹¤.`);
                }
                await database.ref().update(updates);
            } 
            else if (type === 'custom') {
                const customName = prompt("ì›í•˜ëŠ” ì•…ì„¸ì‚¬ë¦¬ ì´ë¦„:");
                if (!customName) return;
                await database.ref(`users/${myID}/inventory`).push({ name: customName, icon: icon });
                await database.ref(`users/${myID}/inventory`).push({ name: customName, icon: icon });
                await database.ref().update(updates);
                alert(`${customName} 2ê°œ íšë“!`);
            }
        }

        function setupNav() {
            const hamburgerBtn = document.getElementById('hamburgerBtn');
            const menuList = document.getElementById('menuList');
            hamburgerBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                menuList.style.display = (menuList.style.display === 'block') ? 'none' : 'block';
            });
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.nav-dropdown') && !e.target.closest('#hamburgerBtn')) {
                    menuList.style.display = 'none';
                }
            });
        }
        function logout() { localStorage.clear(); location.href = "index.html"; }
    </script>
</body>
</html>