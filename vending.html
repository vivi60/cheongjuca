<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>êµ¬í˜• ìíŒê¸°</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
    <script>
      // ê¸°ì¡´ Firebase ì„¤ì •
      const firebaseConfig = {
        apiKey: "AIzaSyAlv59Z0jrLUGdIrhf9INS2G2I4IwLvCr0",
        authDomain: "cheongjuca.firebaseapp.com",
        databaseURL: "https://cheongjuca-default-rtdb.firebaseio.com", 
        projectId: "cheongjuca",
        storageBucket: "cheongjuca.firebasestorage.app",
        messagingSenderId: "455437421321",
        appId: "1:455437421321:web:61711d53c4fa6c9c95e1d8"
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();
    </script>
    <style>
        .vending-container { width: 90%; max-width: 600px; margin: 50px auto; background: #222; padding: 30px; border: 5px solid #444; border-radius: 20px; text-align: center; color: white; font-family: 'SchoolSafeBoardMarker'; }
        .machine-screen { background: #002200; border: 3px solid #004400; padding: 15px; border-radius: 10px; color: #00ff00; margin-bottom: 25px; font-size: 18px; text-shadow: 0 0 5px #00ff00; }
        .vending-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .vending-item { background: #333; border: 2px solid #555; border-radius: 10px; padding: 15px; cursor: pointer; transition: 0.2s; }
        .vending-item:hover { border-color: #00ff00; transform: scale(1.02); }
        .vending-item.disabled { opacity: 0.5; cursor: not-allowed; }
        .price-tag { color: gold; font-size: 14px; margin-top: 5px; }
    </style>
</head>
    <nav class="navbar">
        <div class="logo">
            OUT BREAK 
            <span id="userBadge" style="display: none; font-size: 14px; margin-left: 10px; vertical-align: middle;"></span>
        </div>
        <ul class="nav-links">
            <li><a href="main.html">í™ˆ</a></li>
            <li><a href="sub.html">ìƒì¡´ìëª©ë¡</a></li>
            <li><a href="board.html">ììœ ê²Œì‹œíŒ</a></li>
            <li><a href="quest.html">ì˜ë¢°ê²Œì‹œíŒ</a></li>
            <li><a href="game.html">ë‚šì‹œí„°</a></li>
            <li><a href="vending.html">ìíŒê¸°</a></li>
            <li><a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a></li>
        </ul>
    </nav>
<body style="background-color: #111;">
    <div class="vending-container">
        <h1 style="color: #888; margin-top: 0;">ğŸ¥« ë…¸í›„ëœ ìë™íŒë§¤ê¸°</h1>
        <div class="machine-screen">
            ì†Œì§€ ê¸ˆì•¡: <span id="displayMoney">0</span> G<br>
            <span style="font-size: 14px;">[ ì”ì•¡ í™•ì¸ ì™„ë£Œ... ì„ íƒ ëŒ€ê¸° ì¤‘ ]</span>
        </div>
        <div class="vending-grid">
            <div class="vending-item" onclick="buyVending('ì—ë„ˆì§€ ë“œë§í¬', 'ğŸ¥¤', 50, 20)">
                <div style="font-size: 30px;">ğŸ¥¤</div>
                <div>ì—ë„ˆì§€ ë“œë§í¬</div>
                <div class="price-tag">50 G</div>
            </div>
            <div class="vending-item" onclick="buyVending('ë°©ì‚¬ëŠ¥ ì •í™”ì œ', 'ğŸ’Š', 120, 50)">
                <div style="font-size: 30px;">ğŸ’Š</div>
                <div>ë°©ì‚¬ëŠ¥ ì •í™”ì œ</div>
                <div class="price-tag">120 G</div>
            </div>
        </div>
        <button onclick="location.href='main.html'" style="margin-top: 30px; background: none; border: 1px solid #555; color: #888; cursor: pointer;">[ ëŒì•„ê°€ê¸° ]</button>
    </div>

    <script>
        const myNick = localStorage.getItem("userNick");
        let money = 0;

        // ì‹¤ì‹œê°„ ëˆ ì •ë³´ ë¡œë“œ
        database.ref('users/' + myNick).on('value', (snapshot) => {
            money = snapshot.val()?.money || 0;
            document.getElementById('displayMoney').innerText = money;
        });

        function buyVending(name, icon, price, sellPrice) {
            if (money < price) return alert("ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            if (confirm(`[${name}]ì„(ë¥¼) êµ¬ë§¤í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                // ëˆ ì°¨ê°
                database.ref('users/' + myNick).update({ money: money - price });
                // ì¸ë²¤í† ë¦¬ì— ì¶”ê°€ (ë§ˆìŠ¤í† ëˆ ë´‡ê³¼ í˜¸í™˜ë˜ëŠ” ê·œê²©)
                database.ref('users/' + myNick + '/inventory').push({
                    name: name, icon: icon, price: sellPrice, source: "ìíŒê¸°"
                });
                alert(`${name} êµ¬ë§¤ ì™„ë£Œ!`);
            }
        }
    </script>
</body>
</html>
